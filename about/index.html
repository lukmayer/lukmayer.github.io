<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>index – lukmayer.github.io</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicons/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2fa0555fe88427c29efa1b60aaf9e62d.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-6d7e7b9b3dbd114c66b233ded7072392.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7945e2a833f1e1b32e2a8ee894f2be5e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-034891b1a1cc1f845fd10fe5f270baab.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="lukmayer.github.io">
<meta property="og:image" content="https://lukmayer.github.io/about/assets/reutlingen.jpg">
<meta property="og:site_name" content="lukmayer.github.io">
<meta property="og:image:alt" content="Reutlingen, Germany - Credit">
<meta name="twitter:title" content="lukmayer.github.io">
<meta name="twitter:image" content="https://lukmayer.github.io/about/assets/reutlingen.jpg">
<meta name="twitter:image:alt" content="Reutlingen, Germany - Credit">
<meta name="twitter:card" content="summary_large_image">
<link rel="canonical" href="https://lukmayer.github.io/about/">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">lukmayer.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research/index.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../about/index.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../now/index.html"> 
<span class="menu-text">Now</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://lukmayer.github.io/login_portal/"> 
<span class="menu-text">Login</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block"></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">Sections:</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a>
  <ul>
  <li><a href="#short-bio" id="toc-short-bio" class="nav-link" data-scroll-target="#short-bio">Short bio</a></li>
  <li><a href="#hobbies-and-interests" id="toc-hobbies-and-interests" class="nav-link" data-scroll-target="#hobbies-and-interests">Hobbies and Interests</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<section id="about" class="level1 page-columns page-full">
<h1>About</h1>
<section id="short-bio" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="short-bio">Short bio</h2>
<style>
.description {
    display: none;
}
</style>
<div class="column-body">
<div class="text-center">
<div class="cell">
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="32" data-source-offset="-30"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 31;"><span id="cb1-32"><a href="#cb1-32"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb1-33"><a href="#cb1-33"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co">// Your location data by year</span></span>
<span id="cb1-36"><a href="#cb1-36"></a>locationData <span class="op">=</span> [</span>
<span id="cb1-37"><a href="#cb1-37"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">1998</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">1999</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2000</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2001</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2002</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2003</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Racine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">42.7261</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">87.7828</span> }<span class="op">,</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2004</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2005</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2006</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-46"><a href="#cb1-46"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2007</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2008</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-48"><a href="#cb1-48"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2009</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-49"><a href="#cb1-49"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2010</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-50"><a href="#cb1-50"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2011</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-51"><a href="#cb1-51"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2012</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-52"><a href="#cb1-52"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2013</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2014</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-54"><a href="#cb1-54"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2015</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-55"><a href="#cb1-55"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2016</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2017</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Reutlingen"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Germany"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">48.4921</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="fl">9.2095</span> }<span class="op">,</span></span>
<span id="cb1-57"><a href="#cb1-57"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2018</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Stirling"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Scotland"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">56.1165</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">3.9369</span> }<span class="op">,</span></span>
<span id="cb1-58"><a href="#cb1-58"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2019</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Stirling"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Scotland"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">56.1165</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">3.9369</span> }<span class="op">,</span></span>
<span id="cb1-59"><a href="#cb1-59"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2020</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Stirling"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Scotland"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">56.1165</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">3.9369</span> }<span class="op">,</span></span>
<span id="cb1-60"><a href="#cb1-60"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2021</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Stirling"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"Scotland"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">56.1165</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">3.9369</span> }<span class="op">,</span></span>
<span id="cb1-61"><a href="#cb1-61"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2022</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Royal Leamington Spa"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"England"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">52.2851</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">1.5364</span> }<span class="op">,</span></span>
<span id="cb1-62"><a href="#cb1-62"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2023</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Bath"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"England"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">51.3751</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">2.3618</span> }<span class="op">,</span></span>
<span id="cb1-63"><a href="#cb1-63"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2024</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Irvine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">33.6846</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">117.8265</span> }<span class="op">,</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>  { <span class="dt">year</span><span class="op">:</span> <span class="dv">2025</span><span class="op">,</span> <span class="dt">location</span><span class="op">:</span> <span class="st">"Irvine"</span><span class="op">,</span> <span class="dt">country</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span> <span class="dt">lat</span><span class="op">:</span> <span class="fl">33.6846</span><span class="op">,</span> <span class="dt">lon</span><span class="op">:</span> <span class="op">-</span><span class="fl">117.8265</span> }</span>
<span id="cb1-65"><a href="#cb1-65"></a>]</span>
<span id="cb1-66"><a href="#cb1-66"></a></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="co">// Load world map data</span></span>
<span id="cb1-68"><a href="#cb1-68"></a>world <span class="op">=</span> {</span>
<span id="cb1-69"><a href="#cb1-69"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70"></a>  <span class="cf">return</span> topojson<span class="op">.</span><span class="fu">feature</span>(<span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">,</span> <span class="st">"countries"</span>)<span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71"></a>}</span>
<span id="cb1-72"><a href="#cb1-72"></a></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co">// Function to get current theme colors for timeline map</span></span>
<span id="cb1-74"><a href="#cb1-74"></a>getTimelineThemeColors <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-75"><a href="#cb1-75"></a>  <span class="kw">const</span> isDark <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">contains</span>(<span class="st">'quarto-dark'</span>)<span class="op">;</span></span>
<span id="cb1-76"><a href="#cb1-76"></a></span>
<span id="cb1-77"><a href="#cb1-77"></a>  <span class="cf">if</span> (isDark) {</span>
<span id="cb1-78"><a href="#cb1-78"></a>    <span class="cf">return</span> {</span>
<span id="cb1-79"><a href="#cb1-79"></a>      <span class="dt">landColor</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-80"><a href="#cb1-80"></a>      <span class="dt">countryStroke</span><span class="op">:</span> <span class="st">"#6b7280"</span><span class="op">,</span> <span class="co">// gray-500</span></span>
<span id="cb1-81"><a href="#cb1-81"></a>      <span class="dt">futurePath</span><span class="op">:</span> <span class="st">"#60a5fa"</span><span class="op">,</span> <span class="co">// blue-400</span></span>
<span id="cb1-82"><a href="#cb1-82"></a>      <span class="dt">traveledPath</span><span class="op">:</span> <span class="st">"#f87171"</span><span class="op">,</span> <span class="co">// red-400</span></span>
<span id="cb1-83"><a href="#cb1-83"></a>      <span class="dt">currentMarker</span><span class="op">:</span> <span class="st">"#f87171"</span><span class="op">,</span> <span class="co">// red-400</span></span>
<span id="cb1-84"><a href="#cb1-84"></a>      <span class="dt">otherMarkers</span><span class="op">:</span> <span class="st">"#60a5fa"</span><span class="op">,</span> <span class="co">// blue-400</span></span>
<span id="cb1-85"><a href="#cb1-85"></a>      <span class="dt">markerStroke</span><span class="op">:</span> <span class="st">"#e5e7eb"</span><span class="op">,</span> <span class="co">// gray-200</span></span>
<span id="cb1-86"><a href="#cb1-86"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="st">"#f3f4f6"</span><span class="op">,</span> <span class="co">// gray-100</span></span>
<span id="cb1-87"><a href="#cb1-87"></a>      <span class="dt">labelBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.8)"</span><span class="op">,</span> <span class="co">// gray-900 with opacity</span></span>
<span id="cb1-88"><a href="#cb1-88"></a>      <span class="dt">tooltipBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.95)"</span><span class="op">,</span> <span class="co">// gray-900 with opacity</span></span>
<span id="cb1-89"><a href="#cb1-89"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"#f3f4f6"</span><span class="op">,</span> <span class="co">// gray-100</span></span>
<span id="cb1-90"><a href="#cb1-90"></a>      <span class="dt">tooltipAccent</span><span class="op">:</span> <span class="st">"#fbbf24"</span><span class="op">,</span> <span class="co">// amber-400</span></span>
<span id="cb1-91"><a href="#cb1-91"></a>      <span class="dt">controlsBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.8)"</span><span class="op">,</span> <span class="co">// gray-900 with opacity</span></span>
<span id="cb1-92"><a href="#cb1-92"></a>      <span class="dt">controlsText</span><span class="op">:</span> <span class="st">"#f3f4f6"</span><span class="op">,</span> <span class="co">// gray-100</span></span>
<span id="cb1-93"><a href="#cb1-93"></a>      <span class="dt">controlsButtonBg</span><span class="op">:</span> <span class="st">"rgba(75, 85, 99, 0.8)"</span><span class="op">,</span> <span class="co">// gray-600 with opacity</span></span>
<span id="cb1-94"><a href="#cb1-94"></a>      <span class="dt">sliderBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.8)"</span><span class="op">,</span> <span class="co">// gray-900 with opacity</span></span>
<span id="cb1-95"><a href="#cb1-95"></a>      <span class="dt">sliderText</span><span class="op">:</span> <span class="st">"#f3f4f6"</span><span class="op">,</span> <span class="co">// gray-100</span></span>
<span id="cb1-96"><a href="#cb1-96"></a>      <span class="dt">sliderButtonBg</span><span class="op">:</span> <span class="st">"rgba(75, 85, 99, 0.8)"</span> <span class="co">// gray-600 with opacity</span></span>
<span id="cb1-97"><a href="#cb1-97"></a>    }<span class="op">;</span></span>
<span id="cb1-98"><a href="#cb1-98"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-99"><a href="#cb1-99"></a>    <span class="cf">return</span> {</span>
<span id="cb1-100"><a href="#cb1-100"></a>      <span class="dt">landColor</span><span class="op">:</span> <span class="st">"#e5e7eb"</span><span class="op">,</span> <span class="co">// gray-200</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>      <span class="dt">countryStroke</span><span class="op">:</span> <span class="st">"#9ca3af"</span><span class="op">,</span> <span class="co">// gray-400</span></span>
<span id="cb1-102"><a href="#cb1-102"></a>      <span class="dt">futurePath</span><span class="op">:</span> <span class="st">"#3b82f6"</span><span class="op">,</span> <span class="co">// blue-500</span></span>
<span id="cb1-103"><a href="#cb1-103"></a>      <span class="dt">traveledPath</span><span class="op">:</span> <span class="st">"#ef4444"</span><span class="op">,</span> <span class="co">// red-500</span></span>
<span id="cb1-104"><a href="#cb1-104"></a>      <span class="dt">currentMarker</span><span class="op">:</span> <span class="st">"#ef4444"</span><span class="op">,</span> <span class="co">// red-500</span></span>
<span id="cb1-105"><a href="#cb1-105"></a>      <span class="dt">otherMarkers</span><span class="op">:</span> <span class="st">"#3b82f6"</span><span class="op">,</span> <span class="co">// blue-500</span></span>
<span id="cb1-106"><a href="#cb1-106"></a>      <span class="dt">markerStroke</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-107"><a href="#cb1-107"></a>      <span class="dt">labelText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-108"><a href="#cb1-108"></a>      <span class="dt">labelBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">,</span> <span class="co">// white with opacity</span></span>
<span id="cb1-109"><a href="#cb1-109"></a>      <span class="dt">tooltipBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.95)"</span><span class="op">,</span> <span class="co">// white with opacity</span></span>
<span id="cb1-110"><a href="#cb1-110"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-111"><a href="#cb1-111"></a>      <span class="dt">tooltipAccent</span><span class="op">:</span> <span class="st">"#f59e0b"</span><span class="op">,</span> <span class="co">// amber-500</span></span>
<span id="cb1-112"><a href="#cb1-112"></a>      <span class="dt">controlsBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">,</span> <span class="co">// white with opacity</span></span>
<span id="cb1-113"><a href="#cb1-113"></a>      <span class="dt">controlsText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-114"><a href="#cb1-114"></a>      <span class="dt">controlsButtonBg</span><span class="op">:</span> <span class="st">"rgba(243, 244, 246, 0.8)"</span><span class="op">,</span> <span class="co">// gray-100 with opacity</span></span>
<span id="cb1-115"><a href="#cb1-115"></a>      <span class="dt">sliderBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">,</span> <span class="co">// white with opacity</span></span>
<span id="cb1-116"><a href="#cb1-116"></a>      <span class="dt">sliderText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700</span></span>
<span id="cb1-117"><a href="#cb1-117"></a>      <span class="dt">sliderButtonBg</span><span class="op">:</span> <span class="st">"rgba(243, 244, 246, 0.8)"</span> <span class="co">// gray-100 with opacity</span></span>
<span id="cb1-118"><a href="#cb1-118"></a>    }<span class="op">;</span></span>
<span id="cb1-119"><a href="#cb1-119"></a>  }</span>
<span id="cb1-120"><a href="#cb1-120"></a>}</span>
<span id="cb1-121"><a href="#cb1-121"></a></span>
<span id="cb1-122"><a href="#cb1-122"></a><span class="co">// Theme-adaptive year selector with buttons</span></span>
<span id="cb1-123"><a href="#cb1-123"></a>viewof selectedYear <span class="op">=</span> {</span>
<span id="cb1-124"><a href="#cb1-124"></a>  <span class="kw">const</span> MIN_YEAR <span class="op">=</span> <span class="dv">1998</span><span class="op">;</span></span>
<span id="cb1-125"><a href="#cb1-125"></a>  <span class="kw">const</span> MAX_YEAR <span class="op">=</span> <span class="dv">2025</span><span class="op">;</span></span>
<span id="cb1-126"><a href="#cb1-126"></a>  <span class="kw">const</span> DEFAULT_YEAR <span class="op">=</span> <span class="dv">2025</span><span class="op">;</span></span>
<span id="cb1-127"><a href="#cb1-127"></a></span>
<span id="cb1-128"><a href="#cb1-128"></a>  <span class="kw">const</span> colors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-129"><a href="#cb1-129"></a></span>
<span id="cb1-130"><a href="#cb1-130"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="display: flex; flex-direction: column; width: 100%;"&gt;</span></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="vs">    &lt;div style="display: flex; align-items: center; margin-bottom: 8px;"&gt;</span></span>
<span id="cb1-132"><a href="#cb1-132"></a><span class="vs">      &lt;button id="prev-year" style="</span></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="vs">        background: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">sliderButtonBg</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="vs">        color: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">sliderText</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-135"><a href="#cb1-135"></a><span class="vs">        border: 1px solid </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">countryStroke</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-136"><a href="#cb1-136"></a><span class="vs">        border-radius: 4px; </span></span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="vs">        padding: 4px 8px; </span></span>
<span id="cb1-138"><a href="#cb1-138"></a><span class="vs">        margin-right: 10px;</span></span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb1-140"><a href="#cb1-140"></a><span class="vs">        font-size: 16px;</span></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="vs">        width: 36px;</span></span>
<span id="cb1-142"><a href="#cb1-142"></a><span class="vs">      "&gt;◀&lt;/button&gt;</span></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="vs">      &lt;div style="flex-grow: 1; text-align: center; color: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">sliderText</span><span class="sc">}</span><span class="vs">; font-size: 16px;"&gt;</span></span>
<span id="cb1-144"><a href="#cb1-144"></a><span class="vs">        Year: &lt;span id="year-display"&gt;</span><span class="sc">${</span>DEFAULT_YEAR<span class="sc">}</span><span class="vs">&lt;/span&gt;</span></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="vs">      &lt;/div&gt;</span></span>
<span id="cb1-146"><a href="#cb1-146"></a><span class="vs">      &lt;button id="next-year" style="</span></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="vs">        background: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">sliderButtonBg</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-148"><a href="#cb1-148"></a><span class="vs">        color: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">sliderText</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="vs">        border: 1px solid </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">countryStroke</span><span class="sc">}</span><span class="vs">; </span></span>
<span id="cb1-150"><a href="#cb1-150"></a><span class="vs">        border-radius: 4px; </span></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="vs">        padding: 4px 8px; </span></span>
<span id="cb1-152"><a href="#cb1-152"></a><span class="vs">        margin-left: 10px;</span></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="vs">        cursor: pointer;</span></span>
<span id="cb1-154"><a href="#cb1-154"></a><span class="vs">        font-size: 16px;</span></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="vs">        width: 36px;</span></span>
<span id="cb1-156"><a href="#cb1-156"></a><span class="vs">      "&gt;▶&lt;/button&gt;</span></span>
<span id="cb1-157"><a href="#cb1-157"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="vs">    &lt;input type="range" id="year-slider" min="</span><span class="sc">${</span>MIN_YEAR<span class="sc">}</span><span class="vs">" max="</span><span class="sc">${</span>MAX_YEAR<span class="sc">}</span><span class="vs">" step="1" value="</span><span class="sc">${</span>DEFAULT_YEAR<span class="sc">}</span><span class="vs">" style="width: 100%; accent-color: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">traveledPath</span><span class="sc">}</span><span class="vs">;"&gt;</span></span>
<span id="cb1-159"><a href="#cb1-159"></a><span class="vs">  &lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb1-160"><a href="#cb1-160"></a></span>
<span id="cb1-161"><a href="#cb1-161"></a>  <span class="kw">const</span> slider <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#year-slider"</span>)<span class="op">;</span></span>
<span id="cb1-162"><a href="#cb1-162"></a>  <span class="kw">const</span> display <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#year-display"</span>)<span class="op">;</span></span>
<span id="cb1-163"><a href="#cb1-163"></a>  <span class="kw">const</span> prevBtn <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#prev-year"</span>)<span class="op">;</span></span>
<span id="cb1-164"><a href="#cb1-164"></a>  <span class="kw">const</span> nextBtn <span class="op">=</span> container<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"#next-year"</span>)<span class="op">;</span></span>
<span id="cb1-165"><a href="#cb1-165"></a></span>
<span id="cb1-166"><a href="#cb1-166"></a>  <span class="kw">let</span> value <span class="op">=</span> DEFAULT_YEAR<span class="op">;</span></span>
<span id="cb1-167"><a href="#cb1-167"></a></span>
<span id="cb1-168"><a href="#cb1-168"></a>  <span class="co">// Function to update colors based on theme</span></span>
<span id="cb1-169"><a href="#cb1-169"></a>  <span class="kw">const</span> updateColors <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-170"><a href="#cb1-170"></a>    <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171"></a>    prevBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">sliderButtonBg</span><span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172"></a>    prevBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">color</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">sliderText</span><span class="op">;</span></span>
<span id="cb1-173"><a href="#cb1-173"></a>    prevBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">countryStroke</span><span class="op">;</span></span>
<span id="cb1-174"><a href="#cb1-174"></a>    nextBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">sliderButtonBg</span><span class="op">;</span></span>
<span id="cb1-175"><a href="#cb1-175"></a>    nextBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">color</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">sliderText</span><span class="op">;</span></span>
<span id="cb1-176"><a href="#cb1-176"></a>    nextBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">countryStroke</span><span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177"></a>    display<span class="op">.</span><span class="at">parentElement</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">color</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">sliderText</span><span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178"></a>    slider<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">accentColor</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">traveledPath</span><span class="op">;</span></span>
<span id="cb1-179"><a href="#cb1-179"></a>  }<span class="op">;</span></span>
<span id="cb1-180"><a href="#cb1-180"></a></span>
<span id="cb1-181"><a href="#cb1-181"></a>  <span class="co">// Function to update everything</span></span>
<span id="cb1-182"><a href="#cb1-182"></a>  <span class="kw">const</span> updateYear <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb1-183"><a href="#cb1-183"></a>    year <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(MIN_YEAR<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(MAX_YEAR<span class="op">,</span> year))<span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184"></a>    value <span class="op">=</span> year<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185"></a>    slider<span class="op">.</span><span class="at">value</span> <span class="op">=</span> year<span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186"></a>    display<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> year<span class="op">;</span></span>
<span id="cb1-187"><a href="#cb1-187"></a></span>
<span id="cb1-188"><a href="#cb1-188"></a>    <span class="co">// Update button states</span></span>
<span id="cb1-189"><a href="#cb1-189"></a>    prevBtn<span class="op">.</span><span class="at">disabled</span> <span class="op">=</span> year <span class="op">&lt;=</span> MIN_YEAR<span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190"></a>    prevBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">opacity</span> <span class="op">=</span> year <span class="op">&lt;=</span> MIN_YEAR <span class="op">?</span> <span class="st">"0.5"</span> <span class="op">:</span> <span class="st">"1"</span><span class="op">;</span></span>
<span id="cb1-191"><a href="#cb1-191"></a>    nextBtn<span class="op">.</span><span class="at">disabled</span> <span class="op">=</span> year <span class="op">&gt;=</span> MAX_YEAR<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192"></a>    nextBtn<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">opacity</span> <span class="op">=</span> year <span class="op">&gt;=</span> MAX_YEAR <span class="op">?</span> <span class="st">"0.5"</span> <span class="op">:</span> <span class="st">"1"</span><span class="op">;</span></span>
<span id="cb1-193"><a href="#cb1-193"></a></span>
<span id="cb1-194"><a href="#cb1-194"></a>    container<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb1-195"><a href="#cb1-195"></a>  }<span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196"></a></span>
<span id="cb1-197"><a href="#cb1-197"></a>  <span class="co">// Update when slider changes</span></span>
<span id="cb1-198"><a href="#cb1-198"></a>  slider<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-199"><a href="#cb1-199"></a>    <span class="fu">updateYear</span>(<span class="pp">parseInt</span>(slider<span class="op">.</span><span class="at">value</span>))<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200"></a>  }<span class="op">;</span></span>
<span id="cb1-201"><a href="#cb1-201"></a></span>
<span id="cb1-202"><a href="#cb1-202"></a>  <span class="co">// Previous year button</span></span>
<span id="cb1-203"><a href="#cb1-203"></a>  prevBtn<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-204"><a href="#cb1-204"></a>    <span class="fu">updateYear</span>(value <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-205"><a href="#cb1-205"></a>  }<span class="op">;</span></span>
<span id="cb1-206"><a href="#cb1-206"></a></span>
<span id="cb1-207"><a href="#cb1-207"></a>  <span class="co">// Next year button</span></span>
<span id="cb1-208"><a href="#cb1-208"></a>  nextBtn<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-209"><a href="#cb1-209"></a>    <span class="fu">updateYear</span>(value <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-210"><a href="#cb1-210"></a>  }<span class="op">;</span></span>
<span id="cb1-211"><a href="#cb1-211"></a></span>
<span id="cb1-212"><a href="#cb1-212"></a>  <span class="co">// Add keyboard navigation</span></span>
<span id="cb1-213"><a href="#cb1-213"></a>  container<span class="op">.</span><span class="at">tabIndex</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214"></a>  container<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">outline</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215"></a>  container<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb1-216"><a href="#cb1-216"></a>    <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="fu">key</span> <span class="op">===</span> <span class="st">"ArrowLeft"</span>) {</span>
<span id="cb1-217"><a href="#cb1-217"></a>      <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb1-218"><a href="#cb1-218"></a>      <span class="fu">updateYear</span>(value <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="fu">key</span> <span class="op">===</span> <span class="st">"ArrowRight"</span>) {</span>
<span id="cb1-220"><a href="#cb1-220"></a>      <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb1-221"><a href="#cb1-221"></a>      <span class="fu">updateYear</span>(value <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222"></a>    }</span>
<span id="cb1-223"><a href="#cb1-223"></a>  })<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224"></a></span>
<span id="cb1-225"><a href="#cb1-225"></a>  <span class="co">// Listen for theme changes</span></span>
<span id="cb1-226"><a href="#cb1-226"></a>  <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-227"><a href="#cb1-227"></a>    <span class="fu">updateColors</span>()<span class="op">;</span></span>
<span id="cb1-228"><a href="#cb1-228"></a>  })<span class="op">;</span></span>
<span id="cb1-229"><a href="#cb1-229"></a></span>
<span id="cb1-230"><a href="#cb1-230"></a>  observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> {</span>
<span id="cb1-231"><a href="#cb1-231"></a>    <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-232"><a href="#cb1-232"></a>    <span class="dt">attributeFilter</span><span class="op">:</span> [<span class="st">'class'</span>]</span>
<span id="cb1-233"><a href="#cb1-233"></a>  })<span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234"></a></span>
<span id="cb1-235"><a href="#cb1-235"></a>  <span class="co">// Initialize</span></span>
<span id="cb1-236"><a href="#cb1-236"></a>  <span class="fu">updateYear</span>(DEFAULT_YEAR)<span class="op">;</span></span>
<span id="cb1-237"><a href="#cb1-237"></a>  <span class="fu">updateColors</span>()<span class="op">;</span></span>
<span id="cb1-238"><a href="#cb1-238"></a></span>
<span id="cb1-239"><a href="#cb1-239"></a>  <span class="co">// Define getter for Observable</span></span>
<span id="cb1-240"><a href="#cb1-240"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">defineProperty</span>(container<span class="op">,</span> <span class="st">"value"</span><span class="op">,</span> {</span>
<span id="cb1-241"><a href="#cb1-241"></a>    <span class="kw">get</span><span class="op">:</span> () <span class="kw">=&gt;</span> value</span>
<span id="cb1-242"><a href="#cb1-242"></a>  })<span class="op">;</span></span>
<span id="cb1-243"><a href="#cb1-243"></a></span>
<span id="cb1-244"><a href="#cb1-244"></a>  <span class="cf">return</span> container<span class="op">;</span></span>
<span id="cb1-245"><a href="#cb1-245"></a>}</span>
<span id="cb1-246"><a href="#cb1-246"></a></span>
<span id="cb1-247"><a href="#cb1-247"></a><span class="co">// Current location based on selected year</span></span>
<span id="cb1-248"><a href="#cb1-248"></a>currentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear)</span>
<span id="cb1-249"><a href="#cb1-249"></a></span>
<span id="cb1-250"><a href="#cb1-250"></a><span class="co">// Create a theme-adaptive tooltip element</span></span>
<span id="cb1-251"><a href="#cb1-251"></a>tooltip <span class="op">=</span> {</span>
<span id="cb1-252"><a href="#cb1-252"></a>  <span class="kw">const</span> colors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-253"><a href="#cb1-253"></a></span>
<span id="cb1-254"><a href="#cb1-254"></a>  <span class="kw">const</span> div <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="</span></span>
<span id="cb1-255"><a href="#cb1-255"></a><span class="vs">    position: absolute;</span></span>
<span id="cb1-256"><a href="#cb1-256"></a><span class="vs">    background: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">tooltipBg</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb1-257"><a href="#cb1-257"></a><span class="vs">    border: 1px solid </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">countryStroke</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb1-258"><a href="#cb1-258"></a><span class="vs">    border-radius: 5px;</span></span>
<span id="cb1-259"><a href="#cb1-259"></a><span class="vs">    padding: 10px;</span></span>
<span id="cb1-260"><a href="#cb1-260"></a><span class="vs">    pointer-events: none;</span></span>
<span id="cb1-261"><a href="#cb1-261"></a><span class="vs">    opacity: 0;</span></span>
<span id="cb1-262"><a href="#cb1-262"></a><span class="vs">    transition: opacity 0.2s;</span></span>
<span id="cb1-263"><a href="#cb1-263"></a><span class="vs">    z-index: 1000;</span></span>
<span id="cb1-264"><a href="#cb1-264"></a><span class="vs">    font-family: sans-serif;</span></span>
<span id="cb1-265"><a href="#cb1-265"></a><span class="vs">    font-size: 14px;</span></span>
<span id="cb1-266"><a href="#cb1-266"></a><span class="vs">    max-width: 200px;</span></span>
<span id="cb1-267"><a href="#cb1-267"></a><span class="vs">    color: </span><span class="sc">${</span>colors<span class="op">.</span><span class="at">tooltipText</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb1-268"><a href="#cb1-268"></a><span class="vs">    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);</span></span>
<span id="cb1-269"><a href="#cb1-269"></a><span class="vs">  "&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb1-270"><a href="#cb1-270"></a></span>
<span id="cb1-271"><a href="#cb1-271"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(div)<span class="op">;</span></span>
<span id="cb1-272"><a href="#cb1-272"></a></span>
<span id="cb1-273"><a href="#cb1-273"></a>  <span class="co">// Function to update tooltip colors</span></span>
<span id="cb1-274"><a href="#cb1-274"></a>  <span class="kw">const</span> updateTooltipColors <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-275"><a href="#cb1-275"></a>    <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-276"><a href="#cb1-276"></a>    div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">background</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">tooltipBg</span><span class="op">;</span></span>
<span id="cb1-277"><a href="#cb1-277"></a>    div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">borderColor</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">countryStroke</span><span class="op">;</span></span>
<span id="cb1-278"><a href="#cb1-278"></a>    div<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">color</span> <span class="op">=</span> currentColors<span class="op">.</span><span class="at">tooltipText</span><span class="op">;</span></span>
<span id="cb1-279"><a href="#cb1-279"></a>  }<span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280"></a></span>
<span id="cb1-281"><a href="#cb1-281"></a>  <span class="co">// Listen for theme changes</span></span>
<span id="cb1-282"><a href="#cb1-282"></a>  <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-283"><a href="#cb1-283"></a>    <span class="fu">updateTooltipColors</span>()<span class="op">;</span></span>
<span id="cb1-284"><a href="#cb1-284"></a>  })<span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285"></a></span>
<span id="cb1-286"><a href="#cb1-286"></a>  observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> {</span>
<span id="cb1-287"><a href="#cb1-287"></a>    <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-288"><a href="#cb1-288"></a>    <span class="dt">attributeFilter</span><span class="op">:</span> [<span class="st">'class'</span>]</span>
<span id="cb1-289"><a href="#cb1-289"></a>  })<span class="op">;</span></span>
<span id="cb1-290"><a href="#cb1-290"></a></span>
<span id="cb1-291"><a href="#cb1-291"></a>  <span class="cf">return</span> div<span class="op">;</span></span>
<span id="cb1-292"><a href="#cb1-292"></a>}</span>
<span id="cb1-293"><a href="#cb1-293"></a></span>
<span id="cb1-294"><a href="#cb1-294"></a><span class="co">// Theme-adaptive map visualization</span></span>
<span id="cb1-295"><a href="#cb1-295"></a>mapVisualization <span class="op">=</span> {</span>
<span id="cb1-296"><a href="#cb1-296"></a>  <span class="kw">const</span> colors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-297"><a href="#cb1-297"></a></span>
<span id="cb1-298"><a href="#cb1-298"></a>  <span class="co">// Set up dimensions and projection</span></span>
<span id="cb1-299"><a href="#cb1-299"></a>  <span class="kw">const</span> width <span class="op">=</span> <span class="dv">900</span><span class="op">;</span></span>
<span id="cb1-300"><a href="#cb1-300"></a>  <span class="kw">const</span> height <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb1-301"><a href="#cb1-301"></a></span>
<span id="cb1-302"><a href="#cb1-302"></a>  <span class="co">// Create a projection focused on US and Europe</span></span>
<span id="cb1-303"><a href="#cb1-303"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoMercator</span>()</span>
<span id="cb1-304"><a href="#cb1-304"></a>    <span class="op">.</span><span class="fu">center</span>([<span class="op">-</span><span class="dv">40</span><span class="op">,</span> <span class="dv">45</span>])</span>
<span id="cb1-305"><a href="#cb1-305"></a>    <span class="op">.</span><span class="fu">scale</span>(<span class="dv">250</span>)</span>
<span id="cb1-306"><a href="#cb1-306"></a>    <span class="op">.</span><span class="fu">translate</span>([width <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> height <span class="op">/</span> <span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb1-307"><a href="#cb1-307"></a></span>
<span id="cb1-308"><a href="#cb1-308"></a>  <span class="co">// Create path generator</span></span>
<span id="cb1-309"><a href="#cb1-309"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>()<span class="op">.</span><span class="fu">projection</span>(projection)<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310"></a></span>
<span id="cb1-311"><a href="#cb1-311"></a>  <span class="co">// Create SVG</span></span>
<span id="cb1-312"><a href="#cb1-312"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-313"><a href="#cb1-313"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb1-314"><a href="#cb1-314"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb1-315"><a href="#cb1-315"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb1-316"><a href="#cb1-316"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto;"</span>)<span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317"></a></span>
<span id="cb1-318"><a href="#cb1-318"></a>  <span class="co">// Add ocean background</span></span>
<span id="cb1-319"><a href="#cb1-319"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-320"><a href="#cb1-320"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb1-321"><a href="#cb1-321"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb1-322"><a href="#cb1-322"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-323"><a href="#cb1-323"></a></span>
<span id="cb1-324"><a href="#cb1-324"></a>  <span class="co">// Create a group for all map elements</span></span>
<span id="cb1-325"><a href="#cb1-325"></a>  <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb1-326"><a href="#cb1-326"></a></span>
<span id="cb1-327"><a href="#cb1-327"></a>  <span class="co">// Draw countries</span></span>
<span id="cb1-328"><a href="#cb1-328"></a>  <span class="kw">const</span> countries <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-329"><a href="#cb1-329"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb1-330"><a href="#cb1-330"></a>    <span class="op">.</span><span class="fu">data</span>(world<span class="op">.</span><span class="at">features</span>)</span>
<span id="cb1-331"><a href="#cb1-331"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb1-332"><a href="#cb1-332"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">landColor</span>)</span>
<span id="cb1-333"><a href="#cb1-333"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">countryStroke</span>)</span>
<span id="cb1-334"><a href="#cb1-334"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)</span>
<span id="cb1-335"><a href="#cb1-335"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> path)<span class="op">;</span></span>
<span id="cb1-336"><a href="#cb1-336"></a></span>
<span id="cb1-337"><a href="#cb1-337"></a>  <span class="co">// Get unique locations to avoid drawing the same point multiple times</span></span>
<span id="cb1-338"><a href="#cb1-338"></a>  <span class="kw">const</span> uniqueLocations <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(</span>
<span id="cb1-339"><a href="#cb1-339"></a>    <span class="kw">new</span> <span class="bu">Map</span>(locationData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">lat</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">lon</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> d]))<span class="op">.</span><span class="fu">values</span>()</span>
<span id="cb1-340"><a href="#cb1-340"></a>  )<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">year</span> <span class="op">-</span> b<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb1-341"><a href="#cb1-341"></a></span>
<span id="cb1-342"><a href="#cb1-342"></a>  <span class="co">// Draw path lines connecting unique locations</span></span>
<span id="cb1-343"><a href="#cb1-343"></a>  <span class="kw">const</span> lineGenerator <span class="op">=</span> d3<span class="op">.</span><span class="fu">line</span>()</span>
<span id="cb1-344"><a href="#cb1-344"></a>    <span class="op">.</span><span class="fu">x</span>(d <span class="kw">=&gt;</span> <span class="fu">projection</span>([d<span class="op">.</span><span class="at">lon</span><span class="op">,</span> d<span class="op">.</span><span class="at">lat</span>])[<span class="dv">0</span>])</span>
<span id="cb1-345"><a href="#cb1-345"></a>    <span class="op">.</span><span class="fu">y</span>(d <span class="kw">=&gt;</span> <span class="fu">projection</span>([d<span class="op">.</span><span class="at">lon</span><span class="op">,</span> d<span class="op">.</span><span class="at">lat</span>])[<span class="dv">1</span>])</span>
<span id="cb1-346"><a href="#cb1-346"></a>    <span class="op">.</span><span class="fu">curve</span>(d3<span class="op">.</span><span class="at">curveCardinal</span><span class="op">.</span><span class="fu">tension</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb1-347"><a href="#cb1-347"></a></span>
<span id="cb1-348"><a href="#cb1-348"></a>  <span class="co">// Draw the complete path </span></span>
<span id="cb1-349"><a href="#cb1-349"></a>  <span class="kw">const</span> futurePath <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-350"><a href="#cb1-350"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">lineGenerator</span>(uniqueLocations))</span>
<span id="cb1-351"><a href="#cb1-351"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-352"><a href="#cb1-352"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">futurePath</span>)</span>
<span id="cb1-353"><a href="#cb1-353"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-354"><a href="#cb1-354"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5,5"</span>)</span>
<span id="cb1-355"><a href="#cb1-355"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.7</span>)<span class="op">;</span></span>
<span id="cb1-356"><a href="#cb1-356"></a></span>
<span id="cb1-357"><a href="#cb1-357"></a>  <span class="co">// Highlight the path traveled up to the current year</span></span>
<span id="cb1-358"><a href="#cb1-358"></a>  <span class="kw">const</span> currentYearIndex <span class="op">=</span> uniqueLocations<span class="op">.</span><span class="fu">findIndex</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-359"><a href="#cb1-359"></a>    <span class="kw">const</span> locationsAtThisPoint <span class="op">=</span> locationData<span class="op">.</span><span class="fu">filter</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-360"><a href="#cb1-360"></a>      loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-361"><a href="#cb1-361"></a>    )<span class="op">;</span></span>
<span id="cb1-362"><a href="#cb1-362"></a>    <span class="kw">const</span> years <span class="op">=</span> locationsAtThisPoint<span class="op">.</span><span class="fu">map</span>(loc <span class="kw">=&gt;</span> loc<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb1-363"><a href="#cb1-363"></a>    <span class="kw">const</span> minYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...</span>years)<span class="op">;</span></span>
<span id="cb1-364"><a href="#cb1-364"></a>    <span class="cf">return</span> selectedYear <span class="op">&lt;</span> minYear<span class="op">;</span></span>
<span id="cb1-365"><a href="#cb1-365"></a>  })<span class="op">;</span></span>
<span id="cb1-366"><a href="#cb1-366"></a></span>
<span id="cb1-367"><a href="#cb1-367"></a>  <span class="kw">let</span> traveledPathIndex<span class="op">;</span></span>
<span id="cb1-368"><a href="#cb1-368"></a>  <span class="cf">if</span> (currentYearIndex <span class="op">===</span> <span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb1-369"><a href="#cb1-369"></a>    traveledPathIndex <span class="op">=</span> uniqueLocations<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-370"><a href="#cb1-370"></a>  } <span class="cf">else</span> <span class="cf">if</span> (currentYearIndex <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb1-371"><a href="#cb1-371"></a>    traveledPathIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-372"><a href="#cb1-372"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-373"><a href="#cb1-373"></a>    traveledPathIndex <span class="op">=</span> currentYearIndex<span class="op">;</span></span>
<span id="cb1-374"><a href="#cb1-374"></a>  }</span>
<span id="cb1-375"><a href="#cb1-375"></a></span>
<span id="cb1-376"><a href="#cb1-376"></a>  <span class="co">// Draw traveled path</span></span>
<span id="cb1-377"><a href="#cb1-377"></a>  <span class="kw">let</span> traveledPath <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-378"><a href="#cb1-378"></a>  <span class="cf">if</span> (traveledPathIndex <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-379"><a href="#cb1-379"></a>    <span class="kw">const</span> traveledPathData <span class="op">=</span> uniqueLocations<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> traveledPathIndex)<span class="op">;</span></span>
<span id="cb1-380"><a href="#cb1-380"></a>    traveledPath <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb1-381"><a href="#cb1-381"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">lineGenerator</span>(traveledPathData))</span>
<span id="cb1-382"><a href="#cb1-382"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-383"><a href="#cb1-383"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">traveledPath</span>)</span>
<span id="cb1-384"><a href="#cb1-384"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb1-385"><a href="#cb1-385"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.9</span>)<span class="op">;</span></span>
<span id="cb1-386"><a href="#cb1-386"></a>  }</span>
<span id="cb1-387"><a href="#cb1-387"></a></span>
<span id="cb1-388"><a href="#cb1-388"></a>  <span class="co">// Create a group for markers and labels</span></span>
<span id="cb1-389"><a href="#cb1-389"></a>  <span class="kw">const</span> markersGroup <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb1-390"><a href="#cb1-390"></a></span>
<span id="cb1-391"><a href="#cb1-391"></a>  <span class="co">// Get unique locations for markers</span></span>
<span id="cb1-392"><a href="#cb1-392"></a>  <span class="kw">const</span> markerLocations <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(</span>
<span id="cb1-393"><a href="#cb1-393"></a>    <span class="kw">new</span> <span class="bu">Map</span>(locationData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [<span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">lat</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">lon</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span> d]))<span class="op">.</span><span class="fu">values</span>()</span>
<span id="cb1-394"><a href="#cb1-394"></a>  )<span class="op">;</span></span>
<span id="cb1-395"><a href="#cb1-395"></a></span>
<span id="cb1-396"><a href="#cb1-396"></a>  <span class="co">// Draw all locations as markers</span></span>
<span id="cb1-397"><a href="#cb1-397"></a>  <span class="kw">const</span> markers <span class="op">=</span> markersGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-398"><a href="#cb1-398"></a>    <span class="op">.</span><span class="fu">data</span>(markerLocations)</span>
<span id="cb1-399"><a href="#cb1-399"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-400"><a href="#cb1-400"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">projection</span>([d<span class="op">.</span><span class="at">lon</span><span class="op">,</span> d<span class="op">.</span><span class="at">lat</span>])[<span class="dv">0</span>])</span>
<span id="cb1-401"><a href="#cb1-401"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">projection</span>([d<span class="op">.</span><span class="at">lon</span><span class="op">,</span> d<span class="op">.</span><span class="at">lat</span>])[<span class="dv">1</span>])</span>
<span id="cb1-402"><a href="#cb1-402"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-403"><a href="#cb1-403"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-404"><a href="#cb1-404"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-405"><a href="#cb1-405"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-406"><a href="#cb1-406"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-407"><a href="#cb1-407"></a>      )<span class="op">;</span></span>
<span id="cb1-408"><a href="#cb1-408"></a>      <span class="cf">return</span> isCurrentLocation <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb1-409"><a href="#cb1-409"></a>    })</span>
<span id="cb1-410"><a href="#cb1-410"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-411"><a href="#cb1-411"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-412"><a href="#cb1-412"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-413"><a href="#cb1-413"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-414"><a href="#cb1-414"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-415"><a href="#cb1-415"></a>      )<span class="op">;</span></span>
<span id="cb1-416"><a href="#cb1-416"></a>      <span class="cf">return</span> isCurrentLocation <span class="op">?</span> colors<span class="op">.</span><span class="at">currentMarker</span> <span class="op">:</span> colors<span class="op">.</span><span class="at">otherMarkers</span><span class="op">;</span></span>
<span id="cb1-417"><a href="#cb1-417"></a>    })</span>
<span id="cb1-418"><a href="#cb1-418"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">markerStroke</span>)</span>
<span id="cb1-419"><a href="#cb1-419"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-420"><a href="#cb1-420"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-421"><a href="#cb1-421"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-422"><a href="#cb1-422"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-423"><a href="#cb1-423"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-424"><a href="#cb1-424"></a>      )<span class="op">;</span></span>
<span id="cb1-425"><a href="#cb1-425"></a>      <span class="cf">return</span> isCurrentLocation <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-426"><a href="#cb1-426"></a>    })</span>
<span id="cb1-427"><a href="#cb1-427"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-428"><a href="#cb1-428"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-429"><a href="#cb1-429"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-430"><a href="#cb1-430"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-431"><a href="#cb1-431"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-432"><a href="#cb1-432"></a>      )<span class="op">;</span></span>
<span id="cb1-433"><a href="#cb1-433"></a>      <span class="cf">return</span> isCurrentLocation <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="fl">0.7</span><span class="op">;</span></span>
<span id="cb1-434"><a href="#cb1-434"></a>    })</span>
<span id="cb1-435"><a href="#cb1-435"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb1-436"><a href="#cb1-436"></a>      <span class="kw">const</span> locYears <span class="op">=</span> locationData</span>
<span id="cb1-437"><a href="#cb1-437"></a>        <span class="op">.</span><span class="fu">filter</span>(loc <span class="kw">=&gt;</span> loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span>)</span>
<span id="cb1-438"><a href="#cb1-438"></a>        <span class="op">.</span><span class="fu">map</span>(loc <span class="kw">=&gt;</span> loc<span class="op">.</span><span class="at">year</span>)<span class="op">;</span></span>
<span id="cb1-439"><a href="#cb1-439"></a></span>
<span id="cb1-440"><a href="#cb1-440"></a>      <span class="kw">const</span> yearRanges <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-441"><a href="#cb1-441"></a>      <span class="kw">let</span> start <span class="op">=</span> locYears[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-442"><a href="#cb1-442"></a>      <span class="kw">let</span> end <span class="op">=</span> locYears[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-443"><a href="#cb1-443"></a></span>
<span id="cb1-444"><a href="#cb1-444"></a>      <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> locYears<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-445"><a href="#cb1-445"></a>        <span class="cf">if</span> (locYears[i] <span class="op">===</span> end <span class="op">+</span> <span class="dv">1</span>) {</span>
<span id="cb1-446"><a href="#cb1-446"></a>          end <span class="op">=</span> locYears[i]<span class="op">;</span></span>
<span id="cb1-447"><a href="#cb1-447"></a>        } <span class="cf">else</span> {</span>
<span id="cb1-448"><a href="#cb1-448"></a>          yearRanges<span class="op">.</span><span class="fu">push</span>(start <span class="op">===</span> end <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>start<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>start<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>end<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-449"><a href="#cb1-449"></a>          start <span class="op">=</span> end <span class="op">=</span> locYears[i]<span class="op">;</span></span>
<span id="cb1-450"><a href="#cb1-450"></a>        }</span>
<span id="cb1-451"><a href="#cb1-451"></a>      }</span>
<span id="cb1-452"><a href="#cb1-452"></a>      yearRanges<span class="op">.</span><span class="fu">push</span>(start <span class="op">===</span> end <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>start<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>start<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>end<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb1-453"><a href="#cb1-453"></a></span>
<span id="cb1-454"><a href="#cb1-454"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb1-455"><a href="#cb1-455"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb1-456"><a href="#cb1-456"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb1-457"><a href="#cb1-457"></a></span>
<span id="cb1-458"><a href="#cb1-458"></a>      <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-459"><a href="#cb1-459"></a>      tooltip<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb1-460"><a href="#cb1-460"></a><span class="vs">        &lt;strong style="color: </span><span class="sc">${</span>currentColors<span class="op">.</span><span class="at">tooltipAccent</span><span class="sc">}</span><span class="vs">;"&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">location</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>d<span class="op">.</span><span class="at">country</span><span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br/&gt;</span></span>
<span id="cb1-461"><a href="#cb1-461"></a><span class="vs">        Years: </span><span class="sc">${</span>yearRanges<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>)<span class="sc">}</span><span class="vs">&lt;br/&gt;</span></span>
<span id="cb1-462"><a href="#cb1-462"></a><span class="vs">        Coordinates: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">lat</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>d<span class="op">.</span><span class="at">lon</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span></span>
<span id="cb1-463"><a href="#cb1-463"></a><span class="vs">      `</span><span class="op">;</span></span>
<span id="cb1-464"><a href="#cb1-464"></a></span>
<span id="cb1-465"><a href="#cb1-465"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">opacity</span> <span class="op">=</span> <span class="st">"1"</span><span class="op">;</span></span>
<span id="cb1-466"><a href="#cb1-466"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">left</span> <span class="op">=</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">15</span>) <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb1-467"><a href="#cb1-467"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">top</span> <span class="op">=</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">-</span> <span class="dv">28</span>) <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb1-468"><a href="#cb1-468"></a>    })</span>
<span id="cb1-469"><a href="#cb1-469"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb1-470"><a href="#cb1-470"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-471"><a href="#cb1-471"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-472"><a href="#cb1-472"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-473"><a href="#cb1-473"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-474"><a href="#cb1-474"></a>      )<span class="op">;</span></span>
<span id="cb1-475"><a href="#cb1-475"></a></span>
<span id="cb1-476"><a href="#cb1-476"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb1-477"><a href="#cb1-477"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> isCurrentLocation <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> <span class="dv">4</span>)</span>
<span id="cb1-478"><a href="#cb1-478"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> isCurrentLocation <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-479"><a href="#cb1-479"></a></span>
<span id="cb1-480"><a href="#cb1-480"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">opacity</span> <span class="op">=</span> <span class="st">"0"</span><span class="op">;</span></span>
<span id="cb1-481"><a href="#cb1-481"></a>    })</span>
<span id="cb1-482"><a href="#cb1-482"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb1-483"><a href="#cb1-483"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">left</span> <span class="op">=</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">15</span>) <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb1-484"><a href="#cb1-484"></a>      tooltip<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">top</span> <span class="op">=</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">-</span> <span class="dv">28</span>) <span class="op">+</span> <span class="st">"px"</span><span class="op">;</span></span>
<span id="cb1-485"><a href="#cb1-485"></a>    })<span class="op">;</span></span>
<span id="cb1-486"><a href="#cb1-486"></a></span>
<span id="cb1-487"><a href="#cb1-487"></a>  <span class="co">// Add label for current location</span></span>
<span id="cb1-488"><a href="#cb1-488"></a>  <span class="kw">let</span> currentLocationLabel <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-489"><a href="#cb1-489"></a>  <span class="kw">let</span> currentLocationBg <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-490"><a href="#cb1-490"></a></span>
<span id="cb1-491"><a href="#cb1-491"></a>  <span class="cf">if</span> (currentLocation) {</span>
<span id="cb1-492"><a href="#cb1-492"></a>    <span class="kw">const</span> [x<span class="op">,</span> y] <span class="op">=</span> <span class="fu">projection</span>([currentLocation<span class="op">.</span><span class="at">lon</span><span class="op">,</span> currentLocation<span class="op">.</span><span class="at">lat</span>])<span class="op">;</span></span>
<span id="cb1-493"><a href="#cb1-493"></a></span>
<span id="cb1-494"><a href="#cb1-494"></a>    currentLocationBg <span class="op">=</span> markersGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-495"><a href="#cb1-495"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb1-496"><a href="#cb1-496"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y <span class="op">-</span> <span class="dv">15</span>)</span>
<span id="cb1-497"><a href="#cb1-497"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>currentLocation<span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">length</span> <span class="op">*</span> <span class="dv">8</span> <span class="op">+</span> <span class="dv">30</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-498"><a href="#cb1-498"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="st">"22px"</span>)</span>
<span id="cb1-499"><a href="#cb1-499"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">labelBg</span>)</span>
<span id="cb1-500"><a href="#cb1-500"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb1-501"><a href="#cb1-501"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb1-502"><a href="#cb1-502"></a></span>
<span id="cb1-503"><a href="#cb1-503"></a>    currentLocationLabel <span class="op">=</span> markersGroup<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-504"><a href="#cb1-504"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x <span class="op">+</span> <span class="dv">12</span>)</span>
<span id="cb1-505"><a href="#cb1-505"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y)</span>
<span id="cb1-506"><a href="#cb1-506"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="vs">`</span><span class="sc">${</span>currentLocation<span class="op">.</span><span class="at">location</span><span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>currentLocation<span class="op">.</span><span class="at">year</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb1-507"><a href="#cb1-507"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb1-508"><a href="#cb1-508"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb1-509"><a href="#cb1-509"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-510"><a href="#cb1-510"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">labelText</span>)<span class="op">;</span></span>
<span id="cb1-511"><a href="#cb1-511"></a>  }</span>
<span id="cb1-512"><a href="#cb1-512"></a></span>
<span id="cb1-513"><a href="#cb1-513"></a>  <span class="co">// Add zoom controls</span></span>
<span id="cb1-514"><a href="#cb1-514"></a>  <span class="kw">const</span> zoomControls <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-515"><a href="#cb1-515"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">-</span> <span class="dv">70</span><span class="sc">}</span><span class="vs">, 20)`</span>)<span class="op">;</span></span>
<span id="cb1-516"><a href="#cb1-516"></a></span>
<span id="cb1-517"><a href="#cb1-517"></a>  <span class="co">// Zoom in button</span></span>
<span id="cb1-518"><a href="#cb1-518"></a>  <span class="kw">const</span> zoomInButton <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-519"><a href="#cb1-519"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-520"><a href="#cb1-520"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-521"><a href="#cb1-521"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-522"><a href="#cb1-522"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-523"><a href="#cb1-523"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb1-524"><a href="#cb1-524"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">countryStroke</span>)</span>
<span id="cb1-525"><a href="#cb1-525"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-526"><a href="#cb1-526"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-527"><a href="#cb1-527"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb1-528"><a href="#cb1-528"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> zoom<span class="op">.</span><span class="fu">scaleBy</span>(svg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)<span class="op">,</span> <span class="fl">1.5</span>))<span class="op">;</span></span>
<span id="cb1-529"><a href="#cb1-529"></a></span>
<span id="cb1-530"><a href="#cb1-530"></a>  <span class="kw">const</span> zoomInText <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-531"><a href="#cb1-531"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb1-532"><a href="#cb1-532"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb1-533"><a href="#cb1-533"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-534"><a href="#cb1-534"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsText</span>)</span>
<span id="cb1-535"><a href="#cb1-535"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"18px"</span>)</span>
<span id="cb1-536"><a href="#cb1-536"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-537"><a href="#cb1-537"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-538"><a href="#cb1-538"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"+"</span>)<span class="op">;</span></span>
<span id="cb1-539"><a href="#cb1-539"></a></span>
<span id="cb1-540"><a href="#cb1-540"></a>  <span class="co">// Zoom out button</span></span>
<span id="cb1-541"><a href="#cb1-541"></a>  <span class="kw">const</span> zoomOutButton <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-542"><a href="#cb1-542"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-543"><a href="#cb1-543"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb1-544"><a href="#cb1-544"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-545"><a href="#cb1-545"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-546"><a href="#cb1-546"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb1-547"><a href="#cb1-547"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">countryStroke</span>)</span>
<span id="cb1-548"><a href="#cb1-548"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-549"><a href="#cb1-549"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-550"><a href="#cb1-550"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb1-551"><a href="#cb1-551"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> zoom<span class="op">.</span><span class="fu">scaleBy</span>(svg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)<span class="op">,</span> <span class="fl">0.75</span>))<span class="op">;</span></span>
<span id="cb1-552"><a href="#cb1-552"></a></span>
<span id="cb1-553"><a href="#cb1-553"></a>  <span class="kw">const</span> zoomOutText <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-554"><a href="#cb1-554"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb1-555"><a href="#cb1-555"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">60</span>)</span>
<span id="cb1-556"><a href="#cb1-556"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-557"><a href="#cb1-557"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsText</span>)</span>
<span id="cb1-558"><a href="#cb1-558"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"18px"</span>)</span>
<span id="cb1-559"><a href="#cb1-559"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-560"><a href="#cb1-560"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-561"><a href="#cb1-561"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"−"</span>)<span class="op">;</span></span>
<span id="cb1-562"><a href="#cb1-562"></a></span>
<span id="cb1-563"><a href="#cb1-563"></a>  <span class="co">// Reset button</span></span>
<span id="cb1-564"><a href="#cb1-564"></a>  <span class="kw">const</span> resetButton <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-565"><a href="#cb1-565"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-566"><a href="#cb1-566"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">80</span>)</span>
<span id="cb1-567"><a href="#cb1-567"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-568"><a href="#cb1-568"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb1-569"><a href="#cb1-569"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb1-570"><a href="#cb1-570"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">countryStroke</span>)</span>
<span id="cb1-571"><a href="#cb1-571"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-572"><a href="#cb1-572"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb1-573"><a href="#cb1-573"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb1-574"><a href="#cb1-574"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> resetZoom)<span class="op">;</span></span>
<span id="cb1-575"><a href="#cb1-575"></a></span>
<span id="cb1-576"><a href="#cb1-576"></a>  <span class="kw">const</span> resetText <span class="op">=</span> zoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-577"><a href="#cb1-577"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb1-578"><a href="#cb1-578"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb1-579"><a href="#cb1-579"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-580"><a href="#cb1-580"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsText</span>)</span>
<span id="cb1-581"><a href="#cb1-581"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb1-582"><a href="#cb1-582"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb1-583"><a href="#cb1-583"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-584"><a href="#cb1-584"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"R"</span>)<span class="op">;</span></span>
<span id="cb1-585"><a href="#cb1-585"></a></span>
<span id="cb1-586"><a href="#cb1-586"></a>  <span class="co">// Function to update all colors based on current theme</span></span>
<span id="cb1-587"><a href="#cb1-587"></a>  <span class="kw">function</span> <span class="fu">updateMapColors</span>() {</span>
<span id="cb1-588"><a href="#cb1-588"></a>    <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getTimelineThemeColors</span>()<span class="op">;</span></span>
<span id="cb1-589"><a href="#cb1-589"></a></span>
<span id="cb1-590"><a href="#cb1-590"></a>    <span class="co">// Update countries</span></span>
<span id="cb1-591"><a href="#cb1-591"></a>    countries</span>
<span id="cb1-592"><a href="#cb1-592"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">landColor</span>)</span>
<span id="cb1-593"><a href="#cb1-593"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">countryStroke</span>)<span class="op">;</span></span>
<span id="cb1-594"><a href="#cb1-594"></a></span>
<span id="cb1-595"><a href="#cb1-595"></a>    <span class="co">// Update paths</span></span>
<span id="cb1-596"><a href="#cb1-596"></a>    futurePath<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">futurePath</span>)<span class="op">;</span></span>
<span id="cb1-597"><a href="#cb1-597"></a>    <span class="cf">if</span> (traveledPath) {</span>
<span id="cb1-598"><a href="#cb1-598"></a>      traveledPath<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">traveledPath</span>)<span class="op">;</span></span>
<span id="cb1-599"><a href="#cb1-599"></a>    }</span>
<span id="cb1-600"><a href="#cb1-600"></a></span>
<span id="cb1-601"><a href="#cb1-601"></a>    <span class="co">// Update markers</span></span>
<span id="cb1-602"><a href="#cb1-602"></a>    markers</span>
<span id="cb1-603"><a href="#cb1-603"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-604"><a href="#cb1-604"></a>        <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-605"><a href="#cb1-605"></a>          loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-606"><a href="#cb1-606"></a>          loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-607"><a href="#cb1-607"></a>          loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-608"><a href="#cb1-608"></a>        )<span class="op">;</span></span>
<span id="cb1-609"><a href="#cb1-609"></a>        <span class="cf">return</span> isCurrentLocation <span class="op">?</span> currentColors<span class="op">.</span><span class="at">currentMarker</span> <span class="op">:</span> currentColors<span class="op">.</span><span class="at">otherMarkers</span><span class="op">;</span></span>
<span id="cb1-610"><a href="#cb1-610"></a>      })</span>
<span id="cb1-611"><a href="#cb1-611"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">markerStroke</span>)<span class="op">;</span></span>
<span id="cb1-612"><a href="#cb1-612"></a></span>
<span id="cb1-613"><a href="#cb1-613"></a>    <span class="co">// Update labels</span></span>
<span id="cb1-614"><a href="#cb1-614"></a>    <span class="cf">if</span> (currentLocationBg) {</span>
<span id="cb1-615"><a href="#cb1-615"></a>      currentLocationBg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">labelBg</span>)<span class="op">;</span></span>
<span id="cb1-616"><a href="#cb1-616"></a>    }</span>
<span id="cb1-617"><a href="#cb1-617"></a>    <span class="cf">if</span> (currentLocationLabel) {</span>
<span id="cb1-618"><a href="#cb1-618"></a>      currentLocationLabel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">labelText</span>)<span class="op">;</span></span>
<span id="cb1-619"><a href="#cb1-619"></a>    }</span>
<span id="cb1-620"><a href="#cb1-620"></a></span>
<span id="cb1-621"><a href="#cb1-621"></a>    <span class="co">// Update controls</span></span>
<span id="cb1-622"><a href="#cb1-622"></a>    zoomInButton<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsButtonBg</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">countryStroke</span>)<span class="op">;</span></span>
<span id="cb1-623"><a href="#cb1-623"></a>    zoomOutButton<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsButtonBg</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">countryStroke</span>)<span class="op">;</span></span>
<span id="cb1-624"><a href="#cb1-624"></a>    resetButton<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsButtonBg</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">countryStroke</span>)<span class="op">;</span></span>
<span id="cb1-625"><a href="#cb1-625"></a>    zoomInText<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsText</span>)<span class="op">;</span></span>
<span id="cb1-626"><a href="#cb1-626"></a>    zoomOutText<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsText</span>)<span class="op">;</span></span>
<span id="cb1-627"><a href="#cb1-627"></a>    resetText<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsText</span>)<span class="op">;</span></span>
<span id="cb1-628"><a href="#cb1-628"></a>  }</span>
<span id="cb1-629"><a href="#cb1-629"></a></span>
<span id="cb1-630"><a href="#cb1-630"></a>  <span class="co">// Define zoom behavior</span></span>
<span id="cb1-631"><a href="#cb1-631"></a>  <span class="kw">const</span> zoom <span class="op">=</span> d3<span class="op">.</span><span class="fu">zoom</span>()</span>
<span id="cb1-632"><a href="#cb1-632"></a>    <span class="op">.</span><span class="fu">scaleExtent</span>([<span class="fl">0.5</span><span class="op">,</span> <span class="dv">8</span>])</span>
<span id="cb1-633"><a href="#cb1-633"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"zoom"</span><span class="op">,</span> zoomed)<span class="op">;</span></span>
<span id="cb1-634"><a href="#cb1-634"></a></span>
<span id="cb1-635"><a href="#cb1-635"></a>  <span class="kw">function</span> <span class="fu">zoomed</span>(<span class="bu">event</span>) {</span>
<span id="cb1-636"><a href="#cb1-636"></a>    g<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">transform</span>)<span class="op">;</span></span>
<span id="cb1-637"><a href="#cb1-637"></a>    <span class="kw">const</span> strokeScale <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">event</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">k</span>)<span class="op">;</span></span>
<span id="cb1-638"><a href="#cb1-638"></a>    g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span> <span class="op">*</span> strokeScale)<span class="op">;</span></span>
<span id="cb1-639"><a href="#cb1-639"></a></span>
<span id="cb1-640"><a href="#cb1-640"></a>    markersGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">each</span>(<span class="kw">function</span>(d) {</span>
<span id="cb1-641"><a href="#cb1-641"></a>      <span class="kw">const</span> isCurrentLocation <span class="op">=</span> locationData<span class="op">.</span><span class="fu">some</span>(loc <span class="kw">=&gt;</span> </span>
<span id="cb1-642"><a href="#cb1-642"></a>        loc<span class="op">.</span><span class="at">year</span> <span class="op">===</span> selectedYear <span class="op">&amp;&amp;</span> </span>
<span id="cb1-643"><a href="#cb1-643"></a>        loc<span class="op">.</span><span class="at">lat</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lat</span> <span class="op">&amp;&amp;</span> </span>
<span id="cb1-644"><a href="#cb1-644"></a>        loc<span class="op">.</span><span class="at">lon</span> <span class="op">===</span> d<span class="op">.</span><span class="at">lon</span></span>
<span id="cb1-645"><a href="#cb1-645"></a>      )<span class="op">;</span></span>
<span id="cb1-646"><a href="#cb1-646"></a></span>
<span id="cb1-647"><a href="#cb1-647"></a>      d3<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)</span>
<span id="cb1-648"><a href="#cb1-648"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> (isCurrentLocation <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> <span class="dv">4</span>) <span class="op">*</span> strokeScale)</span>
<span id="cb1-649"><a href="#cb1-649"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> (isCurrentLocation <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">1</span>) <span class="op">*</span> strokeScale)<span class="op">;</span></span>
<span id="cb1-650"><a href="#cb1-650"></a>    })<span class="op">;</span></span>
<span id="cb1-651"><a href="#cb1-651"></a>  }</span>
<span id="cb1-652"><a href="#cb1-652"></a></span>
<span id="cb1-653"><a href="#cb1-653"></a>  <span class="kw">function</span> <span class="fu">resetZoom</span>() {</span>
<span id="cb1-654"><a href="#cb1-654"></a>    svg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">750</span>)<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb1-655"><a href="#cb1-655"></a>      zoom<span class="op">.</span><span class="at">transform</span><span class="op">,</span></span>
<span id="cb1-656"><a href="#cb1-656"></a>      d3<span class="op">.</span><span class="at">zoomIdentity</span></span>
<span id="cb1-657"><a href="#cb1-657"></a>    )<span class="op">;</span></span>
<span id="cb1-658"><a href="#cb1-658"></a>  }</span>
<span id="cb1-659"><a href="#cb1-659"></a></span>
<span id="cb1-660"><a href="#cb1-660"></a>  <span class="co">// Enable zoom and pan on the SVG</span></span>
<span id="cb1-661"><a href="#cb1-661"></a>  svg<span class="op">.</span><span class="fu">call</span>(zoom)<span class="op">;</span></span>
<span id="cb1-662"><a href="#cb1-662"></a></span>
<span id="cb1-663"><a href="#cb1-663"></a>  <span class="co">// Listen for theme changes and update colors accordingly</span></span>
<span id="cb1-664"><a href="#cb1-664"></a>  <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-665"><a href="#cb1-665"></a>    <span class="fu">updateMapColors</span>()<span class="op">;</span></span>
<span id="cb1-666"><a href="#cb1-666"></a>  })<span class="op">;</span></span>
<span id="cb1-667"><a href="#cb1-667"></a></span>
<span id="cb1-668"><a href="#cb1-668"></a>  observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> {</span>
<span id="cb1-669"><a href="#cb1-669"></a>    <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb1-670"><a href="#cb1-670"></a>    <span class="dt">attributeFilter</span><span class="op">:</span> [<span class="st">'class'</span>]</span>
<span id="cb1-671"><a href="#cb1-671"></a>  })<span class="op">;</span></span>
<span id="cb1-672"><a href="#cb1-672"></a></span>
<span id="cb1-673"><a href="#cb1-673"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-674"><a href="#cb1-674"></a>}</span>
<span id="cb1-675"><a href="#cb1-675"></a></span>
<span id="cb1-676"><a href="#cb1-676"></a><span class="co">// Display the map</span></span>
<span id="cb1-677"><a href="#cb1-677"></a>mapVisualization<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<p><br>
</p>
<style>

.observablehq--collapsed,
.observablehq--inspect {
  display: none;
}

</style>
<p>Hi, I’m Luke, or more formally Lukas. I’m a German national with dual citizenship in the US. I was born in Wisconsin, USA but grew up in the greater Stuttgart area (Germany), which is known for its car industry and the Swabian dialect.</p>
<p><br>
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/reutlingen.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Reutlingen, Germany - Credit"><img src="assets/reutlingen.jpg" class="img-fluid figure-img" data-fig-cap="Reutlingen, Germany - Credit: https://www.nts.eu/en/nts-reutlingen/" alt="Reutlingen, Germany - Credit"></a></p>
<figcaption>Reutlingen, Germany - <a href="https://www.nts.eu/en/nts-reutlingen/">Credit</a></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/stuttgart.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Stuttgart, Germany - Credit"><img src="assets/stuttgart.jpg" class="img-fluid figure-img" data-fig-cap="Stuttgart, Germany - Credit: https://www.tripadvisor.com/Tourism-g187291-Stuttgart_Baden_Wurttemberg-Vacations.html" alt="Stuttgart, Germany - Credit"></a></p>
<figcaption>Stuttgart, Germany - <a href="https://www.tripadvisor.com/Tourism-g187291-Stuttgart_Baden_Wurttemberg-Vacations.html">Credit</a></figcaption>
</figure>
</div>
<p>After a brief stint working in a closed psychiatric ward at my local university hospital in Tübingen, I decided to pursue undergraduate education at a <a href="https://www.stir.ac.uk">small university in beautiful Scotland</a>.</p>
<p><br>
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/tuebingen.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Tübingen, Germany - Credit: Westend61/Getty Images"><img src="assets/tuebingen.jpg" class="img-fluid figure-img" data-fig-cap="Tübingen, Germany - Credit: Westend61/Getty Images" alt="Tübingen, Germany - Credit: Westend61/Getty Images"></a></p>
<figcaption>Tübingen, Germany - Credit: Westend61/Getty Images</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/stirling.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Stirling, Scotland - Credit"><img src="assets/stirling.jpg" class="img-fluid figure-img" data-fig-cap="Stirling, Scotland - Credit: https://www.yopa.co.uk/homeowners-hub/whats-it-like-to-live-in-stirling/" alt="Stirling, Scotland - Credit"></a></p>
<figcaption>Stirling, Scotland - <a href="https://www.yopa.co.uk/homeowners-hub/whats-it-like-to-live-in-stirling/">Credit</a></figcaption>
</figure>
</div>
<p>Despite my initial ambitions to pursue a career in clinical psychology, I discovered my analytical side when I was introduced to computer programming by a PhD student in the lab I was helping out in. I got very lucky in this regard as just prior to graduating, I was offered a summer internship at a London-based Data-Science consultancy. I enjoyed the work as it offered diverse problems to solve from different clients, but ultimately I felt that I should also seek formal education in data analytics.</p>
<p>The Behavioral and Data Science M.Sc. at the <a href="https://warwick.ac.uk">University of Warwick</a> was very much the perfect fit for me, as it combined my interest in behavioral research with my newfound passion for select topics in Computer Science. It was at Warwick where I first came to appreciate the application of computational modelling to describe cognitive processes. This was when things “clicked” in my head, and I knew that I wanted to pursue a PhD in this area.</p>
<p><br>
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/leamington.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Royal Leamington Spa, England - Credit"><img src="assets/leamington.jpg" class="img-fluid figure-img" data-fig-cap="Royal Leamington Spa, England - Credit: https://royal-leamington-spa.co.uk/visit/" alt="Royal Leamington Spa, England - Credit"></a></p>
<figcaption>Royal Leamington Spa, England - <a href="https://royal-leamington-spa.co.uk/visit/">Credit</a></figcaption>
</figure>
</div>
<p>I spent a very fun year working in the Applied Digital Behavior Lab at the University of <a href="https://visitbath.co.uk">Bath</a> while preparing my PhD applications and was fortunate to be accepted into the Cognitive Science PhD program at the University of California, Irvine, where I am currently working in <a href="https://steyvers.socsci.uci.edu/madlab/">Mark Steyvers’ lab</a>.</p>
<p><br>
</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/bath.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Bath, England - Credit: Ian Woolcock — Shutterstock"><img src="assets/bath.jpg" class="img-fluid figure-img" data-fig-cap="Bath, England - Credit: Ian Woolcock — Shutterstock" alt="Bath, England - Credit: Ian Woolcock — Shutterstock"></a></p>
<figcaption>Bath, England - Credit: Ian Woolcock — Shutterstock</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="assets/sbsg.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="University of California, Irvine, USA - Credit"><img src="assets/sbsg.jpg" class="img-fluid figure-img" data-fig-cap="University of California, Irvine, USA - Credit: https://www.undergrad.socsci.uci.edu/ssusa/policies.php" alt="University of California, Irvine, USA - Credit"></a></p>
<figcaption>University of California, Irvine, USA - <a href="https://www.undergrad.socsci.uci.edu/ssusa/policies.php">Credit</a></figcaption>
</figure>
</div>
</div>
<hr>
</section>
<section id="hobbies-and-interests" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="hobbies-and-interests">Hobbies and Interests</h2>
<div class="column-body">
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
1. Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I’ve always been pretty active, but when I was younger I somehow never really stuck with any particular sport for too long. To give you an idea, I’ve had a phase for: archery, badminton, Crossfit, golf, parkour, powerlifting, and skateboarding. I’m still interested in strength training, which I have been doing in some form for 10+ years, and badminton. I have limited means to engage with these in an organized format at the moment, so to fill the hole in my heart, I’ve been investing some time to figure out the perfect home gym setup that still fits inside my bedroom. I think I’ve been pretty successful with this, so maybe I’ll show it off in a post sometime.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
2. Technology
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I like GNU/Linux, and use it as my everyday operating system. At the moment, my laptop runs Debian with KDE. I’ve also played around with operating systems on mobile devices, currently using GrapheneOS. I enjoy coding, and wish I could do it more! My favorite languages at the moment are Julia, R, and Python. As you can see, I’ve also taken an interest in web development. While <a href="https://www.quarto.org">Quarto</a> admittedly makes this website pretty easy to create, I also use web development in my research to create experiments that run in a browser. I’m super interested in picking up <a href="https://openprocessing.org/discover/#/trending">creative coding</a> and I am hoping to eventually generate some art that I can post on here! :)</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
3. Languages
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>English used to be my first language as I only started learning German after relocating to <a href="https://www.thelaend.de/en/kampagne/">the Länd</a> at age six. Fast-forward to now, English has become my second language. Maybe because of this strange experience, I’ve had a bit of an interest in language-learning. I have a habit of doing language lessons for fun on <a href="https://www.duolingo.com/profile/luwmayer">Duolingo</a>, where I have a streak of over 2000 days. I’m mostly learning French and Dutch at the moment. My Dutch is definitely better than my French, probably just by virtue of being so similar to German, but both are good enough to follow a YouTube video. I hope to eventually move away from Duolingo and bring my skills to the next level, but don’t feel I have the bandwidth for it just now. If you know a good free resource, <a href="mailto:willuk@vivaldi.net">be sure to let me know</a>!</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
4. Gaming
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I was quite the avid gamer as a teen, spending countless hours on the likes of Team Fortress 2, Minecraft and Guild Wars 2. I don’t actively play much these days, but I still like to keep up with the industry. Perhaps I’m just waiting for the next big thing to come along. I also really enjoy going to board game cafés and completing escape rooms with friends!</p>
</div>
</div>
</div>
<style>
.callout-title-container {
    font-size: 1.2rem;
}

.callout-title-container strong em {
    font-size: 1.5rem;
}



/* change the drop-down arrow */
.py-1 {
    padding-top: .25rem !important;
    padding-bottom: .25rem !important;
    scale: 2;
}

div.callout-important.callout {
    border-left-color:rgba(0, 0, 0, 0.3);
}


</style>
<hr>
<section id="places-ive-been" class="level2">
<h2 class="anchored" data-anchor-id="places-ive-been">Places I’ve been</h2>
<div class="cell">
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="823" data-source-offset="-56"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 822;"><span id="cb2-823"><a href="#cb2-823"></a>d3Highlight <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb2-824"><a href="#cb2-824"></a>topoHighlight <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb2-825"><a href="#cb2-825"></a></span>
<span id="cb2-826"><a href="#cb2-826"></a><span class="co">// Your list of visited countries</span></span>
<span id="cb2-827"><a href="#cb2-827"></a>countriesVisited <span class="op">=</span> [</span>
<span id="cb2-828"><a href="#cb2-828"></a>  <span class="st">"Germany"</span><span class="op">,</span> <span class="st">"France"</span><span class="op">,</span> <span class="st">"USA"</span><span class="op">,</span> <span class="st">"Spain"</span><span class="op">,</span> <span class="st">"Italy"</span><span class="op">,</span> <span class="st">"Austria"</span><span class="op">,</span> </span>
<span id="cb2-829"><a href="#cb2-829"></a>  <span class="st">"Switzerland"</span><span class="op">,</span> <span class="st">"Netherlands"</span><span class="op">,</span> <span class="st">"Belgium"</span><span class="op">,</span> <span class="st">"San Marino"</span><span class="op">,</span> </span>
<span id="cb2-830"><a href="#cb2-830"></a>  <span class="st">"Vatican"</span><span class="op">,</span> <span class="st">"Malta"</span><span class="op">,</span> <span class="st">"Monaco"</span><span class="op">,</span> <span class="st">"United Kingdom"</span></span>
<span id="cb2-831"><a href="#cb2-831"></a>]</span>
<span id="cb2-832"><a href="#cb2-832"></a></span>
<span id="cb2-833"><a href="#cb2-833"></a><span class="co">// Load world map data with a unique variable name</span></span>
<span id="cb2-834"><a href="#cb2-834"></a>worldGeoData <span class="op">=</span> {</span>
<span id="cb2-835"><a href="#cb2-835"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)<span class="op">;</span></span>
<span id="cb2-836"><a href="#cb2-836"></a>  <span class="cf">return</span> topoHighlight<span class="op">.</span><span class="fu">feature</span>(<span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">,</span> <span class="st">"countries"</span>)<span class="op">;</span></span>
<span id="cb2-837"><a href="#cb2-837"></a>}</span>
<span id="cb2-838"><a href="#cb2-838"></a></span>
<span id="cb2-839"><a href="#cb2-839"></a><span class="co">// Function to get current theme colors</span></span>
<span id="cb2-840"><a href="#cb2-840"></a>getThemeColors <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-841"><a href="#cb2-841"></a>  <span class="kw">const</span> isDark <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">contains</span>(<span class="st">'quarto-dark'</span>)<span class="op">;</span></span>
<span id="cb2-842"><a href="#cb2-842"></a></span>
<span id="cb2-843"><a href="#cb2-843"></a>  <span class="cf">if</span> (isDark) {</span>
<span id="cb2-844"><a href="#cb2-844"></a>    <span class="cf">return</span> {</span>
<span id="cb2-845"><a href="#cb2-845"></a>      <span class="dt">visitedColor</span><span class="op">:</span> <span class="st">"#00a653"</span><span class="op">,</span></span>
<span id="cb2-846"><a href="#cb2-846"></a>      <span class="dt">notVisitedColor</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span> <span class="co">// gray-700 equivalent</span></span>
<span id="cb2-847"><a href="#cb2-847"></a>      <span class="dt">strokeColor</span><span class="op">:</span> <span class="st">"#6b7280"</span><span class="op">,</span> <span class="co">// gray-500 equivalent</span></span>
<span id="cb2-848"><a href="#cb2-848"></a>      <span class="dt">strokeHoverColor</span><span class="op">:</span> <span class="st">"#ffffff"</span><span class="op">,</span></span>
<span id="cb2-849"><a href="#cb2-849"></a>      <span class="dt">tooltipBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.95)"</span><span class="op">,</span> <span class="co">// gray-900 with opacity</span></span>
<span id="cb2-850"><a href="#cb2-850"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"#ffffff"</span><span class="op">,</span></span>
<span id="cb2-851"><a href="#cb2-851"></a>      <span class="dt">legendBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.8)"</span><span class="op">,</span></span>
<span id="cb2-852"><a href="#cb2-852"></a>      <span class="dt">legendText</span><span class="op">:</span> <span class="st">"#ffffff"</span><span class="op">,</span></span>
<span id="cb2-853"><a href="#cb2-853"></a>      <span class="dt">controlsBg</span><span class="op">:</span> <span class="st">"rgba(17, 24, 39, 0.8)"</span><span class="op">,</span></span>
<span id="cb2-854"><a href="#cb2-854"></a>      <span class="dt">controlsButtonBg</span><span class="op">:</span> <span class="st">"rgba(75, 85, 99, 0.8)"</span><span class="op">,</span> <span class="co">// gray-600 with opacity</span></span>
<span id="cb2-855"><a href="#cb2-855"></a>      <span class="dt">controlsButtonStroke</span><span class="op">:</span> <span class="st">"#9ca3af"</span> <span class="co">// gray-400</span></span>
<span id="cb2-856"><a href="#cb2-856"></a>    }<span class="op">;</span></span>
<span id="cb2-857"><a href="#cb2-857"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-858"><a href="#cb2-858"></a>    <span class="cf">return</span> {</span>
<span id="cb2-859"><a href="#cb2-859"></a>      <span class="dt">visitedColor</span><span class="op">:</span> <span class="st">"#00a653"</span><span class="op">,</span></span>
<span id="cb2-860"><a href="#cb2-860"></a>      <span class="dt">notVisitedColor</span><span class="op">:</span> <span class="st">"#e5e7eb"</span><span class="op">,</span> <span class="co">// gray-200 equivalent</span></span>
<span id="cb2-861"><a href="#cb2-861"></a>      <span class="dt">strokeColor</span><span class="op">:</span> <span class="st">"#9ca3af"</span><span class="op">,</span> <span class="co">// gray-400 equivalent</span></span>
<span id="cb2-862"><a href="#cb2-862"></a>      <span class="dt">strokeHoverColor</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span></span>
<span id="cb2-863"><a href="#cb2-863"></a>      <span class="dt">tooltipBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.95)"</span><span class="op">,</span></span>
<span id="cb2-864"><a href="#cb2-864"></a>      <span class="dt">tooltipText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span></span>
<span id="cb2-865"><a href="#cb2-865"></a>      <span class="dt">legendBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">,</span></span>
<span id="cb2-866"><a href="#cb2-866"></a>      <span class="dt">legendText</span><span class="op">:</span> <span class="st">"#374151"</span><span class="op">,</span></span>
<span id="cb2-867"><a href="#cb2-867"></a>      <span class="dt">controlsBg</span><span class="op">:</span> <span class="st">"rgba(255, 255, 255, 0.9)"</span><span class="op">,</span></span>
<span id="cb2-868"><a href="#cb2-868"></a>      <span class="dt">controlsButtonBg</span><span class="op">:</span> <span class="st">"rgba(243, 244, 246, 0.8)"</span><span class="op">,</span> <span class="co">// gray-100 with opacity</span></span>
<span id="cb2-869"><a href="#cb2-869"></a>      <span class="dt">controlsButtonStroke</span><span class="op">:</span> <span class="st">"#d1d5db"</span> <span class="co">// gray-300</span></span>
<span id="cb2-870"><a href="#cb2-870"></a>    }<span class="op">;</span></span>
<span id="cb2-871"><a href="#cb2-871"></a>  }</span>
<span id="cb2-872"><a href="#cb2-872"></a>}</span>
<span id="cb2-873"><a href="#cb2-873"></a></span>
<span id="cb2-874"><a href="#cb2-874"></a><span class="co">// Map visualization with theme-adaptive colors</span></span>
<span id="cb2-875"><a href="#cb2-875"></a>highlightedCountriesMap <span class="op">=</span> {</span>
<span id="cb2-876"><a href="#cb2-876"></a>  <span class="kw">const</span> colors <span class="op">=</span> <span class="fu">getThemeColors</span>()<span class="op">;</span></span>
<span id="cb2-877"><a href="#cb2-877"></a></span>
<span id="cb2-878"><a href="#cb2-878"></a>  <span class="co">// Set up dimensions and projection</span></span>
<span id="cb2-879"><a href="#cb2-879"></a>  <span class="kw">const</span> mapWidth <span class="op">=</span> <span class="dv">900</span><span class="op">;</span></span>
<span id="cb2-880"><a href="#cb2-880"></a>  <span class="kw">const</span> mapHeight <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb2-881"><a href="#cb2-881"></a></span>
<span id="cb2-882"><a href="#cb2-882"></a>  <span class="co">// Create a projection focused on the world</span></span>
<span id="cb2-883"><a href="#cb2-883"></a>  <span class="kw">const</span> mapProjection <span class="op">=</span> d3Highlight<span class="op">.</span><span class="fu">geoMercator</span>()</span>
<span id="cb2-884"><a href="#cb2-884"></a>    <span class="op">.</span><span class="fu">center</span>([<span class="dv">10</span><span class="op">,</span> <span class="dv">45</span>])</span>
<span id="cb2-885"><a href="#cb2-885"></a>    <span class="op">.</span><span class="fu">scale</span>(<span class="dv">150</span>)</span>
<span id="cb2-886"><a href="#cb2-886"></a>    <span class="op">.</span><span class="fu">translate</span>([mapWidth <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> mapHeight <span class="op">/</span> <span class="dv">2</span>])<span class="op">;</span></span>
<span id="cb2-887"><a href="#cb2-887"></a></span>
<span id="cb2-888"><a href="#cb2-888"></a>  <span class="co">// Create path generator</span></span>
<span id="cb2-889"><a href="#cb2-889"></a>  <span class="kw">const</span> mapPath <span class="op">=</span> d3Highlight<span class="op">.</span><span class="fu">geoPath</span>()<span class="op">.</span><span class="fu">projection</span>(mapProjection)<span class="op">;</span></span>
<span id="cb2-890"><a href="#cb2-890"></a></span>
<span id="cb2-891"><a href="#cb2-891"></a>  <span class="co">// Create SVG with transparent background</span></span>
<span id="cb2-892"><a href="#cb2-892"></a>  <span class="kw">const</span> mapSvg <span class="op">=</span> d3Highlight<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-893"><a href="#cb2-893"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> mapWidth)</span>
<span id="cb2-894"><a href="#cb2-894"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> mapHeight)</span>
<span id="cb2-895"><a href="#cb2-895"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> mapWidth<span class="op">,</span> mapHeight])</span>
<span id="cb2-896"><a href="#cb2-896"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"style"</span><span class="op">,</span> <span class="st">"max-width: 100%; height: auto; background: none;"</span>)<span class="op">;</span></span>
<span id="cb2-897"><a href="#cb2-897"></a></span>
<span id="cb2-898"><a href="#cb2-898"></a>  <span class="co">// Create a group for all map elements</span></span>
<span id="cb2-899"><a href="#cb2-899"></a>  <span class="kw">const</span> mapGroup <span class="op">=</span> mapSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb2-900"><a href="#cb2-900"></a></span>
<span id="cb2-901"><a href="#cb2-901"></a>  <span class="co">// Create a tooltip</span></span>
<span id="cb2-902"><a href="#cb2-902"></a>  <span class="kw">const</span> mapTooltip <span class="op">=</span> d3Highlight<span class="op">.</span><span class="fu">select</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">"div"</span>))</span>
<span id="cb2-903"><a href="#cb2-903"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"highlight-map-tooltip"</span>)</span>
<span id="cb2-904"><a href="#cb2-904"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"position"</span><span class="op">,</span> <span class="st">"absolute"</span>)</span>
<span id="cb2-905"><a href="#cb2-905"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">tooltipBg</span>)</span>
<span id="cb2-906"><a href="#cb2-906"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">tooltipText</span>)</span>
<span id="cb2-907"><a href="#cb2-907"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span> <span class="st">"5px"</span>)</span>
<span id="cb2-908"><a href="#cb2-908"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"padding"</span><span class="op">,</span> <span class="st">"8px"</span>)</span>
<span id="cb2-909"><a href="#cb2-909"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-910"><a href="#cb2-910"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-911"><a href="#cb2-911"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"z-index"</span><span class="op">,</span> <span class="dv">1000</span>)</span>
<span id="cb2-912"><a href="#cb2-912"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-913"><a href="#cb2-913"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)<span class="op">;</span></span>
<span id="cb2-914"><a href="#cb2-914"></a></span>
<span id="cb2-915"><a href="#cb2-915"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(mapTooltip<span class="op">.</span><span class="fu">node</span>())<span class="op">;</span></span>
<span id="cb2-916"><a href="#cb2-916"></a></span>
<span id="cb2-917"><a href="#cb2-917"></a>  <span class="co">// Country name mapping for special cases</span></span>
<span id="cb2-918"><a href="#cb2-918"></a>  <span class="kw">const</span> countryNameMap <span class="op">=</span> {</span>
<span id="cb2-919"><a href="#cb2-919"></a>    <span class="st">"United States of America"</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span></span>
<span id="cb2-920"><a href="#cb2-920"></a>    <span class="st">"United States"</span><span class="op">:</span> <span class="st">"USA"</span><span class="op">,</span></span>
<span id="cb2-921"><a href="#cb2-921"></a>    <span class="st">"Holy See"</span><span class="op">:</span> <span class="st">"Vatican"</span><span class="op">,</span></span>
<span id="cb2-922"><a href="#cb2-922"></a>    <span class="st">"Vatican City"</span><span class="op">:</span> <span class="st">"Vatican"</span><span class="op">,</span></span>
<span id="cb2-923"><a href="#cb2-923"></a>    <span class="st">"Vatican"</span><span class="op">:</span> <span class="st">"Vatican"</span><span class="op">,</span></span>
<span id="cb2-924"><a href="#cb2-924"></a>    <span class="st">"San Marino"</span><span class="op">:</span> <span class="st">"San Marino"</span></span>
<span id="cb2-925"><a href="#cb2-925"></a>  }<span class="op">;</span></span>
<span id="cb2-926"><a href="#cb2-926"></a></span>
<span id="cb2-927"><a href="#cb2-927"></a>  <span class="co">// Function to update map colors based on current theme</span></span>
<span id="cb2-928"><a href="#cb2-928"></a>  <span class="kw">function</span> <span class="fu">updateMapColors</span>() {</span>
<span id="cb2-929"><a href="#cb2-929"></a>    <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getThemeColors</span>()<span class="op">;</span></span>
<span id="cb2-930"><a href="#cb2-930"></a></span>
<span id="cb2-931"><a href="#cb2-931"></a>    <span class="co">// Update country colors</span></span>
<span id="cb2-932"><a href="#cb2-932"></a>    mapGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb2-933"><a href="#cb2-933"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb2-934"><a href="#cb2-934"></a>        <span class="kw">const</span> countryName <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb2-935"><a href="#cb2-935"></a>        <span class="kw">const</span> normalizedName <span class="op">=</span> countryNameMap[countryName] <span class="op">||</span> countryName<span class="op">;</span></span>
<span id="cb2-936"><a href="#cb2-936"></a>        <span class="cf">return</span> countriesVisited<span class="op">.</span><span class="fu">includes</span>(normalizedName) <span class="op">?</span> currentColors<span class="op">.</span><span class="at">visitedColor</span> <span class="op">:</span> currentColors<span class="op">.</span><span class="at">notVisitedColor</span><span class="op">;</span></span>
<span id="cb2-937"><a href="#cb2-937"></a>      })</span>
<span id="cb2-938"><a href="#cb2-938"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">strokeColor</span>)<span class="op">;</span></span>
<span id="cb2-939"><a href="#cb2-939"></a></span>
<span id="cb2-940"><a href="#cb2-940"></a>    <span class="co">// Update tooltip colors</span></span>
<span id="cb2-941"><a href="#cb2-941"></a>    mapTooltip</span>
<span id="cb2-942"><a href="#cb2-942"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"background"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">tooltipBg</span>)</span>
<span id="cb2-943"><a href="#cb2-943"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"color"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">tooltipText</span>)<span class="op">;</span></span>
<span id="cb2-944"><a href="#cb2-944"></a></span>
<span id="cb2-945"><a href="#cb2-945"></a>    <span class="co">// Update legend colors</span></span>
<span id="cb2-946"><a href="#cb2-946"></a>    mapLegend<span class="op">.</span><span class="fu">select</span>(<span class="st">".legend-bg"</span>)</span>
<span id="cb2-947"><a href="#cb2-947"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">legendBg</span>)<span class="op">;</span></span>
<span id="cb2-948"><a href="#cb2-948"></a></span>
<span id="cb2-949"><a href="#cb2-949"></a>    mapLegend<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".legend-text"</span>)</span>
<span id="cb2-950"><a href="#cb2-950"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">legendText</span>)<span class="op">;</span></span>
<span id="cb2-951"><a href="#cb2-951"></a></span>
<span id="cb2-952"><a href="#cb2-952"></a>    <span class="co">// Update control colors</span></span>
<span id="cb2-953"><a href="#cb2-953"></a>    mapZoomControls<span class="op">.</span><span class="fu">select</span>(<span class="st">".controls-bg"</span>)</span>
<span id="cb2-954"><a href="#cb2-954"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsBg</span>)<span class="op">;</span></span>
<span id="cb2-955"><a href="#cb2-955"></a></span>
<span id="cb2-956"><a href="#cb2-956"></a>    mapZoomControls<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".control-button"</span>)</span>
<span id="cb2-957"><a href="#cb2-957"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb2-958"><a href="#cb2-958"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">controlsButtonStroke</span>)<span class="op">;</span></span>
<span id="cb2-959"><a href="#cb2-959"></a>  }</span>
<span id="cb2-960"><a href="#cb2-960"></a></span>
<span id="cb2-961"><a href="#cb2-961"></a>  <span class="co">// Draw countries</span></span>
<span id="cb2-962"><a href="#cb2-962"></a>  <span class="kw">const</span> countries <span class="op">=</span> mapGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb2-963"><a href="#cb2-963"></a>    <span class="op">.</span><span class="fu">data</span>(worldGeoData<span class="op">.</span><span class="at">features</span>)</span>
<span id="cb2-964"><a href="#cb2-964"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb2-965"><a href="#cb2-965"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb2-966"><a href="#cb2-966"></a>      <span class="kw">const</span> countryName <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb2-967"><a href="#cb2-967"></a>      <span class="kw">const</span> normalizedName <span class="op">=</span> countryNameMap[countryName] <span class="op">||</span> countryName<span class="op">;</span></span>
<span id="cb2-968"><a href="#cb2-968"></a>      <span class="cf">return</span> countriesVisited<span class="op">.</span><span class="fu">includes</span>(normalizedName) <span class="op">?</span> colors<span class="op">.</span><span class="at">visitedColor</span> <span class="op">:</span> colors<span class="op">.</span><span class="at">notVisitedColor</span><span class="op">;</span></span>
<span id="cb2-969"><a href="#cb2-969"></a>    })</span>
<span id="cb2-970"><a href="#cb2-970"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">strokeColor</span>)</span>
<span id="cb2-971"><a href="#cb2-971"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)</span>
<span id="cb2-972"><a href="#cb2-972"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> mapPath)</span>
<span id="cb2-973"><a href="#cb2-973"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseover"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span><span class="op">,</span> d) {</span>
<span id="cb2-974"><a href="#cb2-974"></a>      <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getThemeColors</span>()<span class="op">;</span></span>
<span id="cb2-975"><a href="#cb2-975"></a>      d3Highlight<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">strokeHoverColor</span>)<span class="op">;</span></span>
<span id="cb2-976"><a href="#cb2-976"></a></span>
<span id="cb2-977"><a href="#cb2-977"></a>      <span class="kw">const</span> countryName <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb2-978"><a href="#cb2-978"></a>      <span class="kw">const</span> normalizedName <span class="op">=</span> countryNameMap[countryName] <span class="op">||</span> countryName<span class="op">;</span></span>
<span id="cb2-979"><a href="#cb2-979"></a>      <span class="kw">const</span> isVisited <span class="op">=</span> countriesVisited<span class="op">.</span><span class="fu">includes</span>(normalizedName)<span class="op">;</span></span>
<span id="cb2-980"><a href="#cb2-980"></a></span>
<span id="cb2-981"><a href="#cb2-981"></a>      mapTooltip</span>
<span id="cb2-982"><a href="#cb2-982"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb2-983"><a href="#cb2-983"></a>        <span class="op">.</span><span class="fu">html</span>(<span class="vs">`&lt;strong&gt;</span><span class="sc">${</span>countryName<span class="sc">}</span><span class="vs">&lt;/strong&gt;&lt;br/&gt;</span><span class="sc">${</span>isVisited <span class="op">?</span> <span class="st">"✓ Visited"</span> <span class="op">:</span> <span class="st">"Not visited"</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-984"><a href="#cb2-984"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">10</span>) <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb2-985"><a href="#cb2-985"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">-</span> <span class="dv">28</span>) <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb2-986"><a href="#cb2-986"></a>    })</span>
<span id="cb2-987"><a href="#cb2-987"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseout"</span><span class="op">,</span> <span class="kw">function</span>() {</span>
<span id="cb2-988"><a href="#cb2-988"></a>      <span class="kw">const</span> currentColors <span class="op">=</span> <span class="fu">getThemeColors</span>()<span class="op">;</span></span>
<span id="cb2-989"><a href="#cb2-989"></a>      d3Highlight<span class="op">.</span><span class="fu">select</span>(<span class="kw">this</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> currentColors<span class="op">.</span><span class="at">strokeColor</span>)<span class="op">;</span></span>
<span id="cb2-990"><a href="#cb2-990"></a>      mapTooltip<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-991"><a href="#cb2-991"></a>    })</span>
<span id="cb2-992"><a href="#cb2-992"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mousemove"</span><span class="op">,</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb2-993"><a href="#cb2-993"></a>      mapTooltip</span>
<span id="cb2-994"><a href="#cb2-994"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"left"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageX</span> <span class="op">+</span> <span class="dv">10</span>) <span class="op">+</span> <span class="st">"px"</span>)</span>
<span id="cb2-995"><a href="#cb2-995"></a>        <span class="op">.</span><span class="fu">style</span>(<span class="st">"top"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">.</span><span class="at">pageY</span> <span class="op">-</span> <span class="dv">28</span>) <span class="op">+</span> <span class="st">"px"</span>)<span class="op">;</span></span>
<span id="cb2-996"><a href="#cb2-996"></a>    })<span class="op">;</span></span>
<span id="cb2-997"><a href="#cb2-997"></a></span>
<span id="cb2-998"><a href="#cb2-998"></a>  <span class="co">// Add a legend</span></span>
<span id="cb2-999"><a href="#cb2-999"></a>  <span class="kw">const</span> mapLegend <span class="op">=</span> mapSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-1000"><a href="#cb2-1000"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(20, </span><span class="sc">${</span>mapHeight <span class="op">-</span> <span class="dv">60</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb2-1001"><a href="#cb2-1001"></a></span>
<span id="cb2-1002"><a href="#cb2-1002"></a>  <span class="co">// Background for legend</span></span>
<span id="cb2-1003"><a href="#cb2-1003"></a>  mapLegend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1004"><a href="#cb2-1004"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"legend-bg"</span>)</span>
<span id="cb2-1005"><a href="#cb2-1005"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">5</span>)</span>
<span id="cb2-1006"><a href="#cb2-1006"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">15</span>)</span>
<span id="cb2-1007"><a href="#cb2-1007"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">120</span>)</span>
<span id="cb2-1008"><a href="#cb2-1008"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">70</span>)</span>
<span id="cb2-1009"><a href="#cb2-1009"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendBg</span>)</span>
<span id="cb2-1010"><a href="#cb2-1010"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1011"><a href="#cb2-1011"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb2-1012"><a href="#cb2-1012"></a></span>
<span id="cb2-1013"><a href="#cb2-1013"></a>  <span class="co">// Visited countries legend</span></span>
<span id="cb2-1014"><a href="#cb2-1014"></a>  mapLegend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1015"><a href="#cb2-1015"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-1016"><a href="#cb2-1016"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-1017"><a href="#cb2-1017"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">visitedColor</span>)<span class="op">;</span></span>
<span id="cb2-1018"><a href="#cb2-1018"></a></span>
<span id="cb2-1019"><a href="#cb2-1019"></a>  mapLegend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-1020"><a href="#cb2-1020"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"legend-text"</span>)</span>
<span id="cb2-1021"><a href="#cb2-1021"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1022"><a href="#cb2-1022"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb2-1023"><a href="#cb2-1023"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Visited"</span>)</span>
<span id="cb2-1024"><a href="#cb2-1024"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-1025"><a href="#cb2-1025"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb2-1026"><a href="#cb2-1026"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendText</span>)<span class="op">;</span></span>
<span id="cb2-1027"><a href="#cb2-1027"></a></span>
<span id="cb2-1028"><a href="#cb2-1028"></a>  <span class="co">// Not visited countries legend</span></span>
<span id="cb2-1029"><a href="#cb2-1029"></a>  mapLegend<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1030"><a href="#cb2-1030"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-1031"><a href="#cb2-1031"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-1032"><a href="#cb2-1032"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1033"><a href="#cb2-1033"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">notVisitedColor</span>)<span class="op">;</span></span>
<span id="cb2-1034"><a href="#cb2-1034"></a></span>
<span id="cb2-1035"><a href="#cb2-1035"></a>  mapLegend<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-1036"><a href="#cb2-1036"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"legend-text"</span>)</span>
<span id="cb2-1037"><a href="#cb2-1037"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1038"><a href="#cb2-1038"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">45</span>)</span>
<span id="cb2-1039"><a href="#cb2-1039"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Not Visited"</span>)</span>
<span id="cb2-1040"><a href="#cb2-1040"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb2-1041"><a href="#cb2-1041"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb2-1042"><a href="#cb2-1042"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendText</span>)<span class="op">;</span></span>
<span id="cb2-1043"><a href="#cb2-1043"></a></span>
<span id="cb2-1044"><a href="#cb2-1044"></a>  <span class="co">// Add zoom controls</span></span>
<span id="cb2-1045"><a href="#cb2-1045"></a>  <span class="kw">const</span> mapZoomControls <span class="op">=</span> mapSvg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb2-1046"><a href="#cb2-1046"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>mapWidth <span class="op">-</span> <span class="dv">70</span><span class="sc">}</span><span class="vs">, 20)`</span>)<span class="op">;</span></span>
<span id="cb2-1047"><a href="#cb2-1047"></a></span>
<span id="cb2-1048"><a href="#cb2-1048"></a>  <span class="co">// Background for zoom controls</span></span>
<span id="cb2-1049"><a href="#cb2-1049"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1050"><a href="#cb2-1050"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"controls-bg"</span>)</span>
<span id="cb2-1051"><a href="#cb2-1051"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">5</span>)</span>
<span id="cb2-1052"><a href="#cb2-1052"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="op">-</span><span class="dv">5</span>)</span>
<span id="cb2-1053"><a href="#cb2-1053"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb2-1054"><a href="#cb2-1054"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">120</span>)</span>
<span id="cb2-1055"><a href="#cb2-1055"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsBg</span>)</span>
<span id="cb2-1056"><a href="#cb2-1056"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1057"><a href="#cb2-1057"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb2-1058"><a href="#cb2-1058"></a></span>
<span id="cb2-1059"><a href="#cb2-1059"></a>  <span class="co">// Zoom in button</span></span>
<span id="cb2-1060"><a href="#cb2-1060"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1061"><a href="#cb2-1061"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"control-button"</span>)</span>
<span id="cb2-1062"><a href="#cb2-1062"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-1063"><a href="#cb2-1063"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-1064"><a href="#cb2-1064"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1065"><a href="#cb2-1065"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1066"><a href="#cb2-1066"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb2-1067"><a href="#cb2-1067"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonStroke</span>)</span>
<span id="cb2-1068"><a href="#cb2-1068"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1069"><a href="#cb2-1069"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1070"><a href="#cb2-1070"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb2-1071"><a href="#cb2-1071"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> mapZoomBehavior<span class="op">.</span><span class="fu">scaleBy</span>(mapSvg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)<span class="op">,</span> <span class="fl">1.5</span>))<span class="op">;</span></span>
<span id="cb2-1072"><a href="#cb2-1072"></a></span>
<span id="cb2-1073"><a href="#cb2-1073"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-1074"><a href="#cb2-1074"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb2-1075"><a href="#cb2-1075"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">20</span>)</span>
<span id="cb2-1076"><a href="#cb2-1076"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb2-1077"><a href="#cb2-1077"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendText</span>)</span>
<span id="cb2-1078"><a href="#cb2-1078"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"18px"</span>)</span>
<span id="cb2-1079"><a href="#cb2-1079"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb2-1080"><a href="#cb2-1080"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-1081"><a href="#cb2-1081"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"+"</span>)<span class="op">;</span></span>
<span id="cb2-1082"><a href="#cb2-1082"></a></span>
<span id="cb2-1083"><a href="#cb2-1083"></a>  <span class="co">// Zoom out button</span></span>
<span id="cb2-1084"><a href="#cb2-1084"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1085"><a href="#cb2-1085"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"control-button"</span>)</span>
<span id="cb2-1086"><a href="#cb2-1086"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-1087"><a href="#cb2-1087"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">40</span>)</span>
<span id="cb2-1088"><a href="#cb2-1088"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1089"><a href="#cb2-1089"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1090"><a href="#cb2-1090"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb2-1091"><a href="#cb2-1091"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonStroke</span>)</span>
<span id="cb2-1092"><a href="#cb2-1092"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1093"><a href="#cb2-1093"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1094"><a href="#cb2-1094"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb2-1095"><a href="#cb2-1095"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> mapZoomBehavior<span class="op">.</span><span class="fu">scaleBy</span>(mapSvg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">300</span>)<span class="op">,</span> <span class="fl">0.75</span>))<span class="op">;</span></span>
<span id="cb2-1096"><a href="#cb2-1096"></a></span>
<span id="cb2-1097"><a href="#cb2-1097"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-1098"><a href="#cb2-1098"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb2-1099"><a href="#cb2-1099"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">60</span>)</span>
<span id="cb2-1100"><a href="#cb2-1100"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb2-1101"><a href="#cb2-1101"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendText</span>)</span>
<span id="cb2-1102"><a href="#cb2-1102"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"18px"</span>)</span>
<span id="cb2-1103"><a href="#cb2-1103"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb2-1104"><a href="#cb2-1104"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-1105"><a href="#cb2-1105"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"−"</span>)<span class="op">;</span></span>
<span id="cb2-1106"><a href="#cb2-1106"></a></span>
<span id="cb2-1107"><a href="#cb2-1107"></a>  <span class="co">// Reset button</span></span>
<span id="cb2-1108"><a href="#cb2-1108"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-1109"><a href="#cb2-1109"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"control-button"</span>)</span>
<span id="cb2-1110"><a href="#cb2-1110"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb2-1111"><a href="#cb2-1111"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">80</span>)</span>
<span id="cb2-1112"><a href="#cb2-1112"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1113"><a href="#cb2-1113"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>)</span>
<span id="cb2-1114"><a href="#cb2-1114"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonBg</span>)</span>
<span id="cb2-1115"><a href="#cb2-1115"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">controlsButtonStroke</span>)</span>
<span id="cb2-1116"><a href="#cb2-1116"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1117"><a href="#cb2-1117"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb2-1118"><a href="#cb2-1118"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb2-1119"><a href="#cb2-1119"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> resetMapZoom)<span class="op">;</span></span>
<span id="cb2-1120"><a href="#cb2-1120"></a></span>
<span id="cb2-1121"><a href="#cb2-1121"></a>  mapZoomControls<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-1122"><a href="#cb2-1122"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb2-1123"><a href="#cb2-1123"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb2-1124"><a href="#cb2-1124"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb2-1125"><a href="#cb2-1125"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">legendText</span>)</span>
<span id="cb2-1126"><a href="#cb2-1126"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"14px"</span>)</span>
<span id="cb2-1127"><a href="#cb2-1127"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="st">"bold"</span>)</span>
<span id="cb2-1128"><a href="#cb2-1128"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb2-1129"><a href="#cb2-1129"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"R"</span>)<span class="op">;</span></span>
<span id="cb2-1130"><a href="#cb2-1130"></a></span>
<span id="cb2-1131"><a href="#cb2-1131"></a>  <span class="co">// Define zoom behavior</span></span>
<span id="cb2-1132"><a href="#cb2-1132"></a>  <span class="kw">const</span> mapZoomBehavior <span class="op">=</span> d3Highlight<span class="op">.</span><span class="fu">zoom</span>()</span>
<span id="cb2-1133"><a href="#cb2-1133"></a>    <span class="op">.</span><span class="fu">scaleExtent</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">8</span>])</span>
<span id="cb2-1134"><a href="#cb2-1134"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"zoom"</span><span class="op">,</span> mapZoomed)<span class="op">;</span></span>
<span id="cb2-1135"><a href="#cb2-1135"></a></span>
<span id="cb2-1136"><a href="#cb2-1136"></a>  <span class="kw">function</span> <span class="fu">mapZoomed</span>(<span class="bu">event</span>) {</span>
<span id="cb2-1137"><a href="#cb2-1137"></a>    mapGroup<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">transform</span>)<span class="op">;</span></span>
<span id="cb2-1138"><a href="#cb2-1138"></a>    <span class="kw">const</span> mapStrokeScale <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="bu">event</span><span class="op">.</span><span class="at">transform</span><span class="op">.</span><span class="at">k</span>)<span class="op">;</span></span>
<span id="cb2-1139"><a href="#cb2-1139"></a>    mapGroup<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">0.5</span> <span class="op">*</span> mapStrokeScale)<span class="op">;</span></span>
<span id="cb2-1140"><a href="#cb2-1140"></a>  }</span>
<span id="cb2-1141"><a href="#cb2-1141"></a></span>
<span id="cb2-1142"><a href="#cb2-1142"></a>  <span class="kw">function</span> <span class="fu">resetMapZoom</span>() {</span>
<span id="cb2-1143"><a href="#cb2-1143"></a>    mapSvg<span class="op">.</span><span class="fu">transition</span>()<span class="op">.</span><span class="fu">duration</span>(<span class="dv">750</span>)<span class="op">.</span><span class="fu">call</span>(</span>
<span id="cb2-1144"><a href="#cb2-1144"></a>      mapZoomBehavior<span class="op">.</span><span class="at">transform</span><span class="op">,</span></span>
<span id="cb2-1145"><a href="#cb2-1145"></a>      d3Highlight<span class="op">.</span><span class="at">zoomIdentity</span></span>
<span id="cb2-1146"><a href="#cb2-1146"></a>    )<span class="op">;</span></span>
<span id="cb2-1147"><a href="#cb2-1147"></a>  }</span>
<span id="cb2-1148"><a href="#cb2-1148"></a></span>
<span id="cb2-1149"><a href="#cb2-1149"></a>  <span class="co">// Enable zoom and pan on the SVG</span></span>
<span id="cb2-1150"><a href="#cb2-1150"></a>  mapSvg<span class="op">.</span><span class="fu">call</span>(mapZoomBehavior)<span class="op">;</span></span>
<span id="cb2-1151"><a href="#cb2-1151"></a></span>
<span id="cb2-1152"><a href="#cb2-1152"></a>  <span class="co">// Listen for theme changes and update colors accordingly</span></span>
<span id="cb2-1153"><a href="#cb2-1153"></a>  <span class="kw">const</span> observer <span class="op">=</span> <span class="kw">new</span> <span class="bu">MutationObserver</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb2-1154"><a href="#cb2-1154"></a>    <span class="fu">updateMapColors</span>()<span class="op">;</span></span>
<span id="cb2-1155"><a href="#cb2-1155"></a>  })<span class="op">;</span></span>
<span id="cb2-1156"><a href="#cb2-1156"></a></span>
<span id="cb2-1157"><a href="#cb2-1157"></a>  observer<span class="op">.</span><span class="fu">observe</span>(<span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">,</span> {</span>
<span id="cb2-1158"><a href="#cb2-1158"></a>    <span class="dt">attributes</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb2-1159"><a href="#cb2-1159"></a>    <span class="dt">attributeFilter</span><span class="op">:</span> [<span class="st">'class'</span>]</span>
<span id="cb2-1160"><a href="#cb2-1160"></a>  })<span class="op">;</span></span>
<span id="cb2-1161"><a href="#cb2-1161"></a></span>
<span id="cb2-1162"><a href="#cb2-1162"></a>  <span class="cf">return</span> mapSvg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-1163"><a href="#cb2-1163"></a>}</span>
<span id="cb2-1164"><a href="#cb2-1164"></a></span>
<span id="cb2-1165"><a href="#cb2-1165"></a><span class="co">// Display the map</span></span>
<span id="cb2-1166"><a href="#cb2-1166"></a>highlightedCountriesMap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-7" data-nodetype="expression">

</div>
</div>
</div>
</div>
<style>

.observablehq--collapsed,
.observablehq--inspect {
  display: none;
}

</style>
<p><br>
</p>
<p>I have also visited a few micro-states including: Malta, Monaco, San Marino, and the Vatican.</p>
<hr>
<p><br>
</p>
</section>
</div>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gSW1wb3J0IHJlcXVpcmVkIGxpYnJhcmllc1xuZDMgPSByZXF1aXJlKFwiZDNAN1wiKVxudG9wb2pzb24gPSByZXF1aXJlKFwidG9wb2pzb24tY2xpZW50QDNcIilcblxuLy8gWW91ciBsb2NhdGlvbiBkYXRhIGJ5IHllYXJcbmxvY2F0aW9uRGF0YSA9IFtcbiAgeyB5ZWFyOiAxOTk4LCBsb2NhdGlvbjogXCJSYWNpbmVcIiwgY291bnRyeTogXCJVU0FcIiwgbGF0OiA0Mi43MjYxLCBsb246IC04Ny43ODI4IH0sXG4gIHsgeWVhcjogMTk5OSwgbG9jYXRpb246IFwiUmFjaW5lXCIsIGNvdW50cnk6IFwiVVNBXCIsIGxhdDogNDIuNzI2MSwgbG9uOiAtODcuNzgyOCB9LFxuICB7IHllYXI6IDIwMDAsIGxvY2F0aW9uOiBcIlJhY2luZVwiLCBjb3VudHJ5OiBcIlVTQVwiLCBsYXQ6IDQyLjcyNjEsIGxvbjogLTg3Ljc4MjggfSxcbiAgeyB5ZWFyOiAyMDAxLCBsb2NhdGlvbjogXCJSYWNpbmVcIiwgY291bnRyeTogXCJVU0FcIiwgbGF0OiA0Mi43MjYxLCBsb246IC04Ny43ODI4IH0sXG4gIHsgeWVhcjogMjAwMiwgbG9jYXRpb246IFwiUmFjaW5lXCIsIGNvdW50cnk6IFwiVVNBXCIsIGxhdDogNDIuNzI2MSwgbG9uOiAtODcuNzgyOCB9LFxuICB7IHllYXI6IDIwMDMsIGxvY2F0aW9uOiBcIlJhY2luZVwiLCBjb3VudHJ5OiBcIlVTQVwiLCBsYXQ6IDQyLjcyNjEsIGxvbjogLTg3Ljc4MjggfSxcbiAgeyB5ZWFyOiAyMDA0LCBsb2NhdGlvbjogXCJSZXV0bGluZ2VuXCIsIGNvdW50cnk6IFwiR2VybWFueVwiLCBsYXQ6IDQ4LjQ5MjEsIGxvbjogOS4yMDk1IH0sXG4gIHsgeWVhcjogMjAwNSwgbG9jYXRpb246IFwiUmV1dGxpbmdlblwiLCBjb3VudHJ5OiBcIkdlcm1hbnlcIiwgbGF0OiA0OC40OTIxLCBsb246IDkuMjA5NSB9LFxuICB7IHllYXI6IDIwMDYsIGxvY2F0aW9uOiBcIlJldXRsaW5nZW5cIiwgY291bnRyeTogXCJHZXJtYW55XCIsIGxhdDogNDguNDkyMSwgbG9uOiA5LjIwOTUgfSxcbiAgeyB5ZWFyOiAyMDA3LCBsb2NhdGlvbjogXCJSZXV0bGluZ2VuXCIsIGNvdW50cnk6IFwiR2VybWFueVwiLCBsYXQ6IDQ4LjQ5MjEsIGxvbjogOS4yMDk1IH0sXG4gIHsgeWVhcjogMjAwOCwgbG9jYXRpb246IFwiUmV1dGxpbmdlblwiLCBjb3VudHJ5OiBcIkdlcm1hbnlcIiwgbGF0OiA0OC40OTIxLCBsb246IDkuMjA5NSB9LFxuICB7IHllYXI6IDIwMDksIGxvY2F0aW9uOiBcIlJldXRsaW5nZW5cIiwgY291bnRyeTogXCJHZXJtYW55XCIsIGxhdDogNDguNDkyMSwgbG9uOiA5LjIwOTUgfSxcbiAgeyB5ZWFyOiAyMDEwLCBsb2NhdGlvbjogXCJSZXV0bGluZ2VuXCIsIGNvdW50cnk6IFwiR2VybWFueVwiLCBsYXQ6IDQ4LjQ5MjEsIGxvbjogOS4yMDk1IH0sXG4gIHsgeWVhcjogMjAxMSwgbG9jYXRpb246IFwiUmV1dGxpbmdlblwiLCBjb3VudHJ5OiBcIkdlcm1hbnlcIiwgbGF0OiA0OC40OTIxLCBsb246IDkuMjA5NSB9LFxuICB7IHllYXI6IDIwMTIsIGxvY2F0aW9uOiBcIlJldXRsaW5nZW5cIiwgY291bnRyeTogXCJHZXJtYW55XCIsIGxhdDogNDguNDkyMSwgbG9uOiA5LjIwOTUgfSxcbiAgeyB5ZWFyOiAyMDEzLCBsb2NhdGlvbjogXCJSZXV0bGluZ2VuXCIsIGNvdW50cnk6IFwiR2VybWFueVwiLCBsYXQ6IDQ4LjQ5MjEsIGxvbjogOS4yMDk1IH0sXG4gIHsgeWVhcjogMjAxNCwgbG9jYXRpb246IFwiUmV1dGxpbmdlblwiLCBjb3VudHJ5OiBcIkdlcm1hbnlcIiwgbGF0OiA0OC40OTIxLCBsb246IDkuMjA5NSB9LFxuICB7IHllYXI6IDIwMTUsIGxvY2F0aW9uOiBcIlJldXRsaW5nZW5cIiwgY291bnRyeTogXCJHZXJtYW55XCIsIGxhdDogNDguNDkyMSwgbG9uOiA5LjIwOTUgfSxcbiAgeyB5ZWFyOiAyMDE2LCBsb2NhdGlvbjogXCJSZXV0bGluZ2VuXCIsIGNvdW50cnk6IFwiR2VybWFueVwiLCBsYXQ6IDQ4LjQ5MjEsIGxvbjogOS4yMDk1IH0sXG4gIHsgeWVhcjogMjAxNywgbG9jYXRpb246IFwiUmV1dGxpbmdlblwiLCBjb3VudHJ5OiBcIkdlcm1hbnlcIiwgbGF0OiA0OC40OTIxLCBsb246IDkuMjA5NSB9LFxuICB7IHllYXI6IDIwMTgsIGxvY2F0aW9uOiBcIlN0aXJsaW5nXCIsIGNvdW50cnk6IFwiU2NvdGxhbmRcIiwgbGF0OiA1Ni4xMTY1LCBsb246IC0zLjkzNjkgfSxcbiAgeyB5ZWFyOiAyMDE5LCBsb2NhdGlvbjogXCJTdGlybGluZ1wiLCBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsIGxhdDogNTYuMTE2NSwgbG9uOiAtMy45MzY5IH0sXG4gIHsgeWVhcjogMjAyMCwgbG9jYXRpb246IFwiU3RpcmxpbmdcIiwgY291bnRyeTogXCJTY290bGFuZFwiLCBsYXQ6IDU2LjExNjUsIGxvbjogLTMuOTM2OSB9LFxuICB7IHllYXI6IDIwMjEsIGxvY2F0aW9uOiBcIlN0aXJsaW5nXCIsIGNvdW50cnk6IFwiU2NvdGxhbmRcIiwgbGF0OiA1Ni4xMTY1LCBsb246IC0zLjkzNjkgfSxcbiAgeyB5ZWFyOiAyMDIyLCBsb2NhdGlvbjogXCJSb3lhbCBMZWFtaW5ndG9uIFNwYVwiLCBjb3VudHJ5OiBcIkVuZ2xhbmRcIiwgbGF0OiA1Mi4yODUxLCBsb246IC0xLjUzNjQgfSxcbiAgeyB5ZWFyOiAyMDIzLCBsb2NhdGlvbjogXCJCYXRoXCIsIGNvdW50cnk6IFwiRW5nbGFuZFwiLCBsYXQ6IDUxLjM3NTEsIGxvbjogLTIuMzYxOCB9LFxuICB7IHllYXI6IDIwMjQsIGxvY2F0aW9uOiBcIklydmluZVwiLCBjb3VudHJ5OiBcIlVTQVwiLCBsYXQ6IDMzLjY4NDYsIGxvbjogLTExNy44MjY1IH0sXG4gIHsgeWVhcjogMjAyNSwgbG9jYXRpb246IFwiSXJ2aW5lXCIsIGNvdW50cnk6IFwiVVNBXCIsIGxhdDogMzMuNjg0NiwgbG9uOiAtMTE3LjgyNjUgfVxuXVxuXG4vLyBMb2FkIHdvcmxkIG1hcCBkYXRhXG53b3JsZCA9IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vd29ybGQtYXRsYXNAMi9jb3VudHJpZXMtMTEwbS5qc29uXCIpO1xuICByZXR1cm4gdG9wb2pzb24uZmVhdHVyZShhd2FpdCByZXNwb25zZS5qc29uKCksIFwiY291bnRyaWVzXCIpO1xufVxuXG4vLyBGdW5jdGlvbiB0byBnZXQgY3VycmVudCB0aGVtZSBjb2xvcnMgZm9yIHRpbWVsaW5lIG1hcFxuZ2V0VGltZWxpbmVUaGVtZUNvbG9ycyA9ICgpID0+IHtcbiAgY29uc3QgaXNEYXJrID0gZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3F1YXJ0by1kYXJrJyk7XG5cbiAgaWYgKGlzRGFyaykge1xuICAgIHJldHVybiB7XG4gICAgICBsYW5kQ29sb3I6IFwiIzM3NDE1MVwiLCAvLyBncmF5LTcwMFxuICAgICAgY291bnRyeVN0cm9rZTogXCIjNmI3MjgwXCIsIC8vIGdyYXktNTAwXG4gICAgICBmdXR1cmVQYXRoOiBcIiM2MGE1ZmFcIiwgLy8gYmx1ZS00MDBcbiAgICAgIHRyYXZlbGVkUGF0aDogXCIjZjg3MTcxXCIsIC8vIHJlZC00MDBcbiAgICAgIGN1cnJlbnRNYXJrZXI6IFwiI2Y4NzE3MVwiLCAvLyByZWQtNDAwXG4gICAgICBvdGhlck1hcmtlcnM6IFwiIzYwYTVmYVwiLCAvLyBibHVlLTQwMFxuICAgICAgbWFya2VyU3Ryb2tlOiBcIiNlNWU3ZWJcIiwgLy8gZ3JheS0yMDBcbiAgICAgIGxhYmVsVGV4dDogXCIjZjNmNGY2XCIsIC8vIGdyYXktMTAwXG4gICAgICBsYWJlbEJnOiBcInJnYmEoMTcsIDI0LCAzOSwgMC44KVwiLCAvLyBncmF5LTkwMCB3aXRoIG9wYWNpdHlcbiAgICAgIHRvb2x0aXBCZzogXCJyZ2JhKDE3LCAyNCwgMzksIDAuOTUpXCIsIC8vIGdyYXktOTAwIHdpdGggb3BhY2l0eVxuICAgICAgdG9vbHRpcFRleHQ6IFwiI2YzZjRmNlwiLCAvLyBncmF5LTEwMFxuICAgICAgdG9vbHRpcEFjY2VudDogXCIjZmJiZjI0XCIsIC8vIGFtYmVyLTQwMFxuICAgICAgY29udHJvbHNCZzogXCJyZ2JhKDE3LCAyNCwgMzksIDAuOClcIiwgLy8gZ3JheS05MDAgd2l0aCBvcGFjaXR5XG4gICAgICBjb250cm9sc1RleHQ6IFwiI2YzZjRmNlwiLCAvLyBncmF5LTEwMFxuICAgICAgY29udHJvbHNCdXR0b25CZzogXCJyZ2JhKDc1LCA4NSwgOTksIDAuOClcIiwgLy8gZ3JheS02MDAgd2l0aCBvcGFjaXR5XG4gICAgICBzbGlkZXJCZzogXCJyZ2JhKDE3LCAyNCwgMzksIDAuOClcIiwgLy8gZ3JheS05MDAgd2l0aCBvcGFjaXR5XG4gICAgICBzbGlkZXJUZXh0OiBcIiNmM2Y0ZjZcIiwgLy8gZ3JheS0xMDBcbiAgICAgIHNsaWRlckJ1dHRvbkJnOiBcInJnYmEoNzUsIDg1LCA5OSwgMC44KVwiIC8vIGdyYXktNjAwIHdpdGggb3BhY2l0eVxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhbmRDb2xvcjogXCIjZTVlN2ViXCIsIC8vIGdyYXktMjAwXG4gICAgICBjb3VudHJ5U3Ryb2tlOiBcIiM5Y2EzYWZcIiwgLy8gZ3JheS00MDBcbiAgICAgIGZ1dHVyZVBhdGg6IFwiIzNiODJmNlwiLCAvLyBibHVlLTUwMFxuICAgICAgdHJhdmVsZWRQYXRoOiBcIiNlZjQ0NDRcIiwgLy8gcmVkLTUwMFxuICAgICAgY3VycmVudE1hcmtlcjogXCIjZWY0NDQ0XCIsIC8vIHJlZC01MDBcbiAgICAgIG90aGVyTWFya2VyczogXCIjM2I4MmY2XCIsIC8vIGJsdWUtNTAwXG4gICAgICBtYXJrZXJTdHJva2U6IFwiIzM3NDE1MVwiLCAvLyBncmF5LTcwMFxuICAgICAgbGFiZWxUZXh0OiBcIiMzNzQxNTFcIiwgLy8gZ3JheS03MDBcbiAgICAgIGxhYmVsQmc6IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjkpXCIsIC8vIHdoaXRlIHdpdGggb3BhY2l0eVxuICAgICAgdG9vbHRpcEJnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45NSlcIiwgLy8gd2hpdGUgd2l0aCBvcGFjaXR5XG4gICAgICB0b29sdGlwVGV4dDogXCIjMzc0MTUxXCIsIC8vIGdyYXktNzAwXG4gICAgICB0b29sdGlwQWNjZW50OiBcIiNmNTllMGJcIiwgLy8gYW1iZXItNTAwXG4gICAgICBjb250cm9sc0JnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiLCAvLyB3aGl0ZSB3aXRoIG9wYWNpdHlcbiAgICAgIGNvbnRyb2xzVGV4dDogXCIjMzc0MTUxXCIsIC8vIGdyYXktNzAwXG4gICAgICBjb250cm9sc0J1dHRvbkJnOiBcInJnYmEoMjQzLCAyNDQsIDI0NiwgMC44KVwiLCAvLyBncmF5LTEwMCB3aXRoIG9wYWNpdHlcbiAgICAgIHNsaWRlckJnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiLCAvLyB3aGl0ZSB3aXRoIG9wYWNpdHlcbiAgICAgIHNsaWRlclRleHQ6IFwiIzM3NDE1MVwiLCAvLyBncmF5LTcwMFxuICAgICAgc2xpZGVyQnV0dG9uQmc6IFwicmdiYSgyNDMsIDI0NCwgMjQ2LCAwLjgpXCIgLy8gZ3JheS0xMDAgd2l0aCBvcGFjaXR5XG4gICAgfTtcbiAgfVxufVxuXG4vLyBUaGVtZS1hZGFwdGl2ZSB5ZWFyIHNlbGVjdG9yIHdpdGggYnV0dG9uc1xudmlld29mIHNlbGVjdGVkWWVhciA9IHtcbiAgY29uc3QgTUlOX1lFQVIgPSAxOTk4O1xuICBjb25zdCBNQVhfWUVBUiA9IDIwMjU7XG4gIGNvbnN0IERFRkFVTFRfWUVBUiA9IDIwMjU7XG5cbiAgY29uc3QgY29sb3JzID0gZ2V0VGltZWxpbmVUaGVtZUNvbG9ycygpO1xuXG4gIGNvbnN0IGNvbnRhaW5lciA9IGh0bWxgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IHdpZHRoOiAxMDAlO1wiPlxuICAgIDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBtYXJnaW4tYm90dG9tOiA4cHg7XCI+XG4gICAgICA8YnV0dG9uIGlkPVwicHJldi15ZWFyXCIgc3R5bGU9XCJcbiAgICAgICAgYmFja2dyb3VuZDogJHtjb2xvcnMuc2xpZGVyQnV0dG9uQmd9OyBcbiAgICAgICAgY29sb3I6ICR7Y29sb3JzLnNsaWRlclRleHR9OyBcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgJHtjb2xvcnMuY291bnRyeVN0cm9rZX07IFxuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7IFxuICAgICAgICBwYWRkaW5nOiA0cHggOHB4OyBcbiAgICAgICAgbWFyZ2luLXJpZ2h0OiAxMHB4O1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgICAgd2lkdGg6IDM2cHg7XG4gICAgICBcIj7il4A8L2J1dHRvbj5cbiAgICAgIDxkaXYgc3R5bGU9XCJmbGV4LWdyb3c6IDE7IHRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6ICR7Y29sb3JzLnNsaWRlclRleHR9OyBmb250LXNpemU6IDE2cHg7XCI+XG4gICAgICAgIFllYXI6IDxzcGFuIGlkPVwieWVhci1kaXNwbGF5XCI+JHtERUZBVUxUX1lFQVJ9PC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgICA8YnV0dG9uIGlkPVwibmV4dC15ZWFyXCIgc3R5bGU9XCJcbiAgICAgICAgYmFja2dyb3VuZDogJHtjb2xvcnMuc2xpZGVyQnV0dG9uQmd9OyBcbiAgICAgICAgY29sb3I6ICR7Y29sb3JzLnNsaWRlclRleHR9OyBcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgJHtjb2xvcnMuY291bnRyeVN0cm9rZX07IFxuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7IFxuICAgICAgICBwYWRkaW5nOiA0cHggOHB4OyBcbiAgICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICB3aWR0aDogMzZweDtcbiAgICAgIFwiPuKWtjwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIDxpbnB1dCB0eXBlPVwicmFuZ2VcIiBpZD1cInllYXItc2xpZGVyXCIgbWluPVwiJHtNSU5fWUVBUn1cIiBtYXg9XCIke01BWF9ZRUFSfVwiIHN0ZXA9XCIxXCIgdmFsdWU9XCIke0RFRkFVTFRfWUVBUn1cIiBzdHlsZT1cIndpZHRoOiAxMDAlOyBhY2NlbnQtY29sb3I6ICR7Y29sb3JzLnRyYXZlbGVkUGF0aH07XCI+XG4gIDwvZGl2PmA7XG5cbiAgY29uc3Qgc2xpZGVyID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjeWVhci1zbGlkZXJcIik7XG4gIGNvbnN0IGRpc3BsYXkgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiN5ZWFyLWRpc3BsYXlcIik7XG4gIGNvbnN0IHByZXZCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiNwcmV2LXllYXJcIik7XG4gIGNvbnN0IG5leHRCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIiNuZXh0LXllYXJcIik7XG5cbiAgbGV0IHZhbHVlID0gREVGQVVMVF9ZRUFSO1xuXG4gIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBjb2xvcnMgYmFzZWQgb24gdGhlbWVcbiAgY29uc3QgdXBkYXRlQ29sb3JzID0gKCkgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRDb2xvcnMgPSBnZXRUaW1lbGluZVRoZW1lQ29sb3JzKCk7XG4gICAgcHJldkJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gY3VycmVudENvbG9ycy5zbGlkZXJCdXR0b25CZztcbiAgICBwcmV2QnRuLnN0eWxlLmNvbG9yID0gY3VycmVudENvbG9ycy5zbGlkZXJUZXh0O1xuICAgIHByZXZCdG4uc3R5bGUuYm9yZGVyQ29sb3IgPSBjdXJyZW50Q29sb3JzLmNvdW50cnlTdHJva2U7XG4gICAgbmV4dEJ0bi5zdHlsZS5iYWNrZ3JvdW5kID0gY3VycmVudENvbG9ycy5zbGlkZXJCdXR0b25CZztcbiAgICBuZXh0QnRuLnN0eWxlLmNvbG9yID0gY3VycmVudENvbG9ycy5zbGlkZXJUZXh0O1xuICAgIG5leHRCdG4uc3R5bGUuYm9yZGVyQ29sb3IgPSBjdXJyZW50Q29sb3JzLmNvdW50cnlTdHJva2U7XG4gICAgZGlzcGxheS5wYXJlbnRFbGVtZW50LnN0eWxlLmNvbG9yID0gY3VycmVudENvbG9ycy5zbGlkZXJUZXh0O1xuICAgIHNsaWRlci5zdHlsZS5hY2NlbnRDb2xvciA9IGN1cnJlbnRDb2xvcnMudHJhdmVsZWRQYXRoO1xuICB9O1xuXG4gIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBldmVyeXRoaW5nXG4gIGNvbnN0IHVwZGF0ZVllYXIgPSAoeWVhcikgPT4ge1xuICAgIHllYXIgPSBNYXRoLm1heChNSU5fWUVBUiwgTWF0aC5taW4oTUFYX1lFQVIsIHllYXIpKTtcbiAgICB2YWx1ZSA9IHllYXI7XG4gICAgc2xpZGVyLnZhbHVlID0geWVhcjtcbiAgICBkaXNwbGF5LnRleHRDb250ZW50ID0geWVhcjtcblxuICAgIC8vIFVwZGF0ZSBidXR0b24gc3RhdGVzXG4gICAgcHJldkJ0bi5kaXNhYmxlZCA9IHllYXIgPD0gTUlOX1lFQVI7XG4gICAgcHJldkJ0bi5zdHlsZS5vcGFjaXR5ID0geWVhciA8PSBNSU5fWUVBUiA/IFwiMC41XCIgOiBcIjFcIjtcbiAgICBuZXh0QnRuLmRpc2FibGVkID0geWVhciA+PSBNQVhfWUVBUjtcbiAgICBuZXh0QnRuLnN0eWxlLm9wYWNpdHkgPSB5ZWFyID49IE1BWF9ZRUFSID8gXCIwLjVcIiA6IFwiMVwiO1xuXG4gICAgY29udGFpbmVyLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIikpO1xuICB9O1xuXG4gIC8vIFVwZGF0ZSB3aGVuIHNsaWRlciBjaGFuZ2VzXG4gIHNsaWRlci5vbmlucHV0ID0gKCkgPT4ge1xuICAgIHVwZGF0ZVllYXIocGFyc2VJbnQoc2xpZGVyLnZhbHVlKSk7XG4gIH07XG5cbiAgLy8gUHJldmlvdXMgeWVhciBidXR0b25cbiAgcHJldkJ0bi5vbmNsaWNrID0gKCkgPT4ge1xuICAgIHVwZGF0ZVllYXIodmFsdWUgLSAxKTtcbiAgfTtcblxuICAvLyBOZXh0IHllYXIgYnV0dG9uXG4gIG5leHRCdG4ub25jbGljayA9ICgpID0+IHtcbiAgICB1cGRhdGVZZWFyKHZhbHVlICsgMSk7XG4gIH07XG5cbiAgLy8gQWRkIGtleWJvYXJkIG5hdmlnYXRpb25cbiAgY29udGFpbmVyLnRhYkluZGV4ID0gMDtcbiAgY29udGFpbmVyLnN0eWxlLm91dGxpbmUgPSBcIm5vbmVcIjtcbiAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChldmVudCkgPT4ge1xuICAgIGlmIChldmVudC5rZXkgPT09IFwiQXJyb3dMZWZ0XCIpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB1cGRhdGVZZWFyKHZhbHVlIC0gMSk7XG4gICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09IFwiQXJyb3dSaWdodFwiKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdXBkYXRlWWVhcih2YWx1ZSArIDEpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gTGlzdGVuIGZvciB0aGVtZSBjaGFuZ2VzXG4gIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKCkgPT4ge1xuICAgIHVwZGF0ZUNvbG9ycygpO1xuICB9KTtcblxuICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHtcbiAgICBhdHRyaWJ1dGVzOiB0cnVlLFxuICAgIGF0dHJpYnV0ZUZpbHRlcjogWydjbGFzcyddXG4gIH0pO1xuXG4gIC8vIEluaXRpYWxpemVcbiAgdXBkYXRlWWVhcihERUZBVUxUX1lFQVIpO1xuICB1cGRhdGVDb2xvcnMoKTtcblxuICAvLyBEZWZpbmUgZ2V0dGVyIGZvciBPYnNlcnZhYmxlXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb250YWluZXIsIFwidmFsdWVcIiwge1xuICAgIGdldDogKCkgPT4gdmFsdWVcbiAgfSk7XG5cbiAgcmV0dXJuIGNvbnRhaW5lcjtcbn1cblxuLy8gQ3VycmVudCBsb2NhdGlvbiBiYXNlZCBvbiBzZWxlY3RlZCB5ZWFyXG5jdXJyZW50TG9jYXRpb24gPSBsb2NhdGlvbkRhdGEuZmluZChkID0+IGQueWVhciA9PT0gc2VsZWN0ZWRZZWFyKVxuXG4vLyBDcmVhdGUgYSB0aGVtZS1hZGFwdGl2ZSB0b29sdGlwIGVsZW1lbnRcbnRvb2x0aXAgPSB7XG4gIGNvbnN0IGNvbG9ycyA9IGdldFRpbWVsaW5lVGhlbWVDb2xvcnMoKTtcblxuICBjb25zdCBkaXYgPSBodG1sYDxkaXYgc3R5bGU9XCJcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgYmFja2dyb3VuZDogJHtjb2xvcnMudG9vbHRpcEJnfTtcbiAgICBib3JkZXI6IDFweCBzb2xpZCAke2NvbG9ycy5jb3VudHJ5U3Ryb2tlfTtcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgcGFkZGluZzogMTBweDtcbiAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICBvcGFjaXR5OiAwO1xuICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4ycztcbiAgICB6LWluZGV4OiAxMDAwO1xuICAgIGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmO1xuICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICBtYXgtd2lkdGg6IDIwMHB4O1xuICAgIGNvbG9yOiAke2NvbG9ycy50b29sdGlwVGV4dH07XG4gICAgYm94LXNoYWRvdzogMCAycHggNXB4IHJnYmEoMCwgMCwgMCwgMC4zKTtcbiAgXCI+PC9kaXY+YDtcblxuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRpdik7XG5cbiAgLy8gRnVuY3Rpb24gdG8gdXBkYXRlIHRvb2x0aXAgY29sb3JzXG4gIGNvbnN0IHVwZGF0ZVRvb2x0aXBDb2xvcnMgPSAoKSA9PiB7XG4gICAgY29uc3QgY3VycmVudENvbG9ycyA9IGdldFRpbWVsaW5lVGhlbWVDb2xvcnMoKTtcbiAgICBkaXYuc3R5bGUuYmFja2dyb3VuZCA9IGN1cnJlbnRDb2xvcnMudG9vbHRpcEJnO1xuICAgIGRpdi5zdHlsZS5ib3JkZXJDb2xvciA9IGN1cnJlbnRDb2xvcnMuY291bnRyeVN0cm9rZTtcbiAgICBkaXYuc3R5bGUuY29sb3IgPSBjdXJyZW50Q29sb3JzLnRvb2x0aXBUZXh0O1xuICB9O1xuXG4gIC8vIExpc3RlbiBmb3IgdGhlbWUgY2hhbmdlc1xuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICB1cGRhdGVUb29sdGlwQ29sb3JzKCk7XG4gIH0pO1xuXG4gIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuYm9keSwge1xuICAgIGF0dHJpYnV0ZXM6IHRydWUsXG4gICAgYXR0cmlidXRlRmlsdGVyOiBbJ2NsYXNzJ11cbiAgfSk7XG5cbiAgcmV0dXJuIGRpdjtcbn1cblxuLy8gVGhlbWUtYWRhcHRpdmUgbWFwIHZpc3VhbGl6YXRpb25cbm1hcFZpc3VhbGl6YXRpb24gPSB7XG4gIGNvbnN0IGNvbG9ycyA9IGdldFRpbWVsaW5lVGhlbWVDb2xvcnMoKTtcblxuICAvLyBTZXQgdXAgZGltZW5zaW9ucyBhbmQgcHJvamVjdGlvblxuICBjb25zdCB3aWR0aCA9IDkwMDtcbiAgY29uc3QgaGVpZ2h0ID0gNTAwO1xuXG4gIC8vIENyZWF0ZSBhIHByb2plY3Rpb24gZm9jdXNlZCBvbiBVUyBhbmQgRXVyb3BlXG4gIGNvbnN0IHByb2plY3Rpb24gPSBkMy5nZW9NZXJjYXRvcigpXG4gICAgLmNlbnRlcihbLTQwLCA0NV0pXG4gICAgLnNjYWxlKDI1MClcbiAgICAudHJhbnNsYXRlKFt3aWR0aCAvIDIsIGhlaWdodCAvIDJdKTtcblxuICAvLyBDcmVhdGUgcGF0aCBnZW5lcmF0b3JcbiAgY29uc3QgcGF0aCA9IGQzLmdlb1BhdGgoKS5wcm9qZWN0aW9uKHByb2plY3Rpb24pO1xuXG4gIC8vIENyZWF0ZSBTVkdcbiAgY29uc3Qgc3ZnID0gZDMuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSlcbiAgICAuYXR0cihcInN0eWxlXCIsIFwibWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87XCIpO1xuXG4gIC8vIEFkZCBvY2VhbiBiYWNrZ3JvdW5kXG4gIHN2Zy5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKTtcblxuICAvLyBDcmVhdGUgYSBncm91cCBmb3IgYWxsIG1hcCBlbGVtZW50c1xuICBjb25zdCBnID0gc3ZnLmFwcGVuZChcImdcIik7XG5cbiAgLy8gRHJhdyBjb3VudHJpZXNcbiAgY29uc3QgY291bnRyaWVzID0gZy5hcHBlbmQoXCJnXCIpXG4gICAgLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAuZGF0YSh3b3JsZC5mZWF0dXJlcylcbiAgICAuam9pbihcInBhdGhcIilcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmxhbmRDb2xvcilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuY291bnRyeVN0cm9rZSlcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAwLjUpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgpO1xuXG4gIC8vIEdldCB1bmlxdWUgbG9jYXRpb25zIHRvIGF2b2lkIGRyYXdpbmcgdGhlIHNhbWUgcG9pbnQgbXVsdGlwbGUgdGltZXNcbiAgY29uc3QgdW5pcXVlTG9jYXRpb25zID0gQXJyYXkuZnJvbShcbiAgICBuZXcgTWFwKGxvY2F0aW9uRGF0YS5tYXAoZCA9PiBbYCR7ZC5sYXR9LCR7ZC5sb259YCwgZF0pKS52YWx1ZXMoKVxuICApLnNvcnQoKGEsIGIpID0+IGEueWVhciAtIGIueWVhcik7XG5cbiAgLy8gRHJhdyBwYXRoIGxpbmVzIGNvbm5lY3RpbmcgdW5pcXVlIGxvY2F0aW9uc1xuICBjb25zdCBsaW5lR2VuZXJhdG9yID0gZDMubGluZSgpXG4gICAgLngoZCA9PiBwcm9qZWN0aW9uKFtkLmxvbiwgZC5sYXRdKVswXSlcbiAgICAueShkID0+IHByb2plY3Rpb24oW2QubG9uLCBkLmxhdF0pWzFdKVxuICAgIC5jdXJ2ZShkMy5jdXJ2ZUNhcmRpbmFsLnRlbnNpb24oMC41KSk7XG5cbiAgLy8gRHJhdyB0aGUgY29tcGxldGUgcGF0aCBcbiAgY29uc3QgZnV0dXJlUGF0aCA9IGcuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBsaW5lR2VuZXJhdG9yKHVuaXF1ZUxvY2F0aW9ucykpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNvbG9ycy5mdXR1cmVQYXRoKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDIpXG4gICAgLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIFwiNSw1XCIpXG4gICAgLmF0dHIoXCJvcGFjaXR5XCIsIDAuNyk7XG5cbiAgLy8gSGlnaGxpZ2h0IHRoZSBwYXRoIHRyYXZlbGVkIHVwIHRvIHRoZSBjdXJyZW50IHllYXJcbiAgY29uc3QgY3VycmVudFllYXJJbmRleCA9IHVuaXF1ZUxvY2F0aW9ucy5maW5kSW5kZXgoZCA9PiB7XG4gICAgY29uc3QgbG9jYXRpb25zQXRUaGlzUG9pbnQgPSBsb2NhdGlvbkRhdGEuZmlsdGVyKGxvYyA9PiBcbiAgICAgIGxvYy5sYXQgPT09IGQubGF0ICYmIGxvYy5sb24gPT09IGQubG9uXG4gICAgKTtcbiAgICBjb25zdCB5ZWFycyA9IGxvY2F0aW9uc0F0VGhpc1BvaW50Lm1hcChsb2MgPT4gbG9jLnllYXIpO1xuICAgIGNvbnN0IG1pblllYXIgPSBNYXRoLm1pbiguLi55ZWFycyk7XG4gICAgcmV0dXJuIHNlbGVjdGVkWWVhciA8IG1pblllYXI7XG4gIH0pO1xuXG4gIGxldCB0cmF2ZWxlZFBhdGhJbmRleDtcbiAgaWYgKGN1cnJlbnRZZWFySW5kZXggPT09IC0xKSB7XG4gICAgdHJhdmVsZWRQYXRoSW5kZXggPSB1bmlxdWVMb2NhdGlvbnMubGVuZ3RoO1xuICB9IGVsc2UgaWYgKGN1cnJlbnRZZWFySW5kZXggPT09IDApIHtcbiAgICB0cmF2ZWxlZFBhdGhJbmRleCA9IDA7XG4gIH0gZWxzZSB7XG4gICAgdHJhdmVsZWRQYXRoSW5kZXggPSBjdXJyZW50WWVhckluZGV4O1xuICB9XG5cbiAgLy8gRHJhdyB0cmF2ZWxlZCBwYXRoXG4gIGxldCB0cmF2ZWxlZFBhdGggPSBudWxsO1xuICBpZiAodHJhdmVsZWRQYXRoSW5kZXggPiAwKSB7XG4gICAgY29uc3QgdHJhdmVsZWRQYXRoRGF0YSA9IHVuaXF1ZUxvY2F0aW9ucy5zbGljZSgwLCB0cmF2ZWxlZFBhdGhJbmRleCk7XG4gICAgdHJhdmVsZWRQYXRoID0gZy5hcHBlbmQoXCJwYXRoXCIpXG4gICAgICAuYXR0cihcImRcIiwgbGluZUdlbmVyYXRvcih0cmF2ZWxlZFBhdGhEYXRhKSlcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNvbG9ycy50cmF2ZWxlZFBhdGgpXG4gICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAzKVxuICAgICAgLmF0dHIoXCJvcGFjaXR5XCIsIDAuOSk7XG4gIH1cblxuICAvLyBDcmVhdGUgYSBncm91cCBmb3IgbWFya2VycyBhbmQgbGFiZWxzXG4gIGNvbnN0IG1hcmtlcnNHcm91cCA9IGcuYXBwZW5kKFwiZ1wiKTtcblxuICAvLyBHZXQgdW5pcXVlIGxvY2F0aW9ucyBmb3IgbWFya2Vyc1xuICBjb25zdCBtYXJrZXJMb2NhdGlvbnMgPSBBcnJheS5mcm9tKFxuICAgIG5ldyBNYXAobG9jYXRpb25EYXRhLm1hcChkID0+IFtgJHtkLmxhdH0sJHtkLmxvbn1gLCBkXSkpLnZhbHVlcygpXG4gICk7XG5cbiAgLy8gRHJhdyBhbGwgbG9jYXRpb25zIGFzIG1hcmtlcnNcbiAgY29uc3QgbWFya2VycyA9IG1hcmtlcnNHcm91cC5zZWxlY3RBbGwoXCJjaXJjbGVcIilcbiAgICAuZGF0YShtYXJrZXJMb2NhdGlvbnMpXG4gICAgLmpvaW4oXCJjaXJjbGVcIilcbiAgICAuYXR0cihcImN4XCIsIGQgPT4gcHJvamVjdGlvbihbZC5sb24sIGQubGF0XSlbMF0pXG4gICAgLmF0dHIoXCJjeVwiLCBkID0+IHByb2plY3Rpb24oW2QubG9uLCBkLmxhdF0pWzFdKVxuICAgIC5hdHRyKFwiclwiLCBkID0+IHtcbiAgICAgIGNvbnN0IGlzQ3VycmVudExvY2F0aW9uID0gbG9jYXRpb25EYXRhLnNvbWUobG9jID0+IFxuICAgICAgICBsb2MueWVhciA9PT0gc2VsZWN0ZWRZZWFyICYmIFxuICAgICAgICBsb2MubGF0ID09PSBkLmxhdCAmJiBcbiAgICAgICAgbG9jLmxvbiA9PT0gZC5sb25cbiAgICAgICk7XG4gICAgICByZXR1cm4gaXNDdXJyZW50TG9jYXRpb24gPyA4IDogNDtcbiAgICB9KVxuICAgIC5hdHRyKFwiZmlsbFwiLCBkID0+IHtcbiAgICAgIGNvbnN0IGlzQ3VycmVudExvY2F0aW9uID0gbG9jYXRpb25EYXRhLnNvbWUobG9jID0+IFxuICAgICAgICBsb2MueWVhciA9PT0gc2VsZWN0ZWRZZWFyICYmIFxuICAgICAgICBsb2MubGF0ID09PSBkLmxhdCAmJiBcbiAgICAgICAgbG9jLmxvbiA9PT0gZC5sb25cbiAgICAgICk7XG4gICAgICByZXR1cm4gaXNDdXJyZW50TG9jYXRpb24gPyBjb2xvcnMuY3VycmVudE1hcmtlciA6IGNvbG9ycy5vdGhlck1hcmtlcnM7XG4gICAgfSlcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMubWFya2VyU3Ryb2tlKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIGQgPT4ge1xuICAgICAgY29uc3QgaXNDdXJyZW50TG9jYXRpb24gPSBsb2NhdGlvbkRhdGEuc29tZShsb2MgPT4gXG4gICAgICAgIGxvYy55ZWFyID09PSBzZWxlY3RlZFllYXIgJiYgXG4gICAgICAgIGxvYy5sYXQgPT09IGQubGF0ICYmIFxuICAgICAgICBsb2MubG9uID09PSBkLmxvblxuICAgICAgKTtcbiAgICAgIHJldHVybiBpc0N1cnJlbnRMb2NhdGlvbiA/IDIgOiAxO1xuICAgIH0pXG4gICAgLmF0dHIoXCJvcGFjaXR5XCIsIGQgPT4ge1xuICAgICAgY29uc3QgaXNDdXJyZW50TG9jYXRpb24gPSBsb2NhdGlvbkRhdGEuc29tZShsb2MgPT4gXG4gICAgICAgIGxvYy55ZWFyID09PSBzZWxlY3RlZFllYXIgJiYgXG4gICAgICAgIGxvYy5sYXQgPT09IGQubGF0ICYmIFxuICAgICAgICBsb2MubG9uID09PSBkLmxvblxuICAgICAgKTtcbiAgICAgIHJldHVybiBpc0N1cnJlbnRMb2NhdGlvbiA/IDEgOiAwLjc7XG4gICAgfSlcbiAgICAub24oXCJtb3VzZW92ZXJcIiwgZnVuY3Rpb24oZXZlbnQsIGQpIHtcbiAgICAgIGNvbnN0IGxvY1llYXJzID0gbG9jYXRpb25EYXRhXG4gICAgICAgIC5maWx0ZXIobG9jID0+IGxvYy5sYXQgPT09IGQubGF0ICYmIGxvYy5sb24gPT09IGQubG9uKVxuICAgICAgICAubWFwKGxvYyA9PiBsb2MueWVhcik7XG5cbiAgICAgIGNvbnN0IHllYXJSYW5nZXMgPSBbXTtcbiAgICAgIGxldCBzdGFydCA9IGxvY1llYXJzWzBdO1xuICAgICAgbGV0IGVuZCA9IGxvY1llYXJzWzBdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxvY1llYXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChsb2NZZWFyc1tpXSA9PT0gZW5kICsgMSkge1xuICAgICAgICAgIGVuZCA9IGxvY1llYXJzW2ldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHllYXJSYW5nZXMucHVzaChzdGFydCA9PT0gZW5kID8gYCR7c3RhcnR9YCA6IGAke3N0YXJ0fS0ke2VuZH1gKTtcbiAgICAgICAgICBzdGFydCA9IGVuZCA9IGxvY1llYXJzW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB5ZWFyUmFuZ2VzLnB1c2goc3RhcnQgPT09IGVuZCA/IGAke3N0YXJ0fWAgOiBgJHtzdGFydH0tJHtlbmR9YCk7XG5cbiAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAuYXR0cihcInJcIiwgMTIpXG4gICAgICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuXG4gICAgICBjb25zdCBjdXJyZW50Q29sb3JzID0gZ2V0VGltZWxpbmVUaGVtZUNvbG9ycygpO1xuICAgICAgdG9vbHRpcC5pbm5lckhUTUwgPSBgXG4gICAgICAgIDxzdHJvbmcgc3R5bGU9XCJjb2xvcjogJHtjdXJyZW50Q29sb3JzLnRvb2x0aXBBY2NlbnR9O1wiPiR7ZC5sb2NhdGlvbn0sICR7ZC5jb3VudHJ5fTwvc3Ryb25nPjxici8+XG4gICAgICAgIFllYXJzOiAke3llYXJSYW5nZXMuam9pbihcIiwgXCIpfTxici8+XG4gICAgICAgIENvb3JkaW5hdGVzOiAke2QubGF0LnRvRml4ZWQoMil9LCAke2QubG9uLnRvRml4ZWQoMil9XG4gICAgICBgO1xuXG4gICAgICB0b29sdGlwLnN0eWxlLm9wYWNpdHkgPSBcIjFcIjtcbiAgICAgIHRvb2x0aXAuc3R5bGUubGVmdCA9IChldmVudC5wYWdlWCArIDE1KSArIFwicHhcIjtcbiAgICAgIHRvb2x0aXAuc3R5bGUudG9wID0gKGV2ZW50LnBhZ2VZIC0gMjgpICsgXCJweFwiO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oZXZlbnQsIGQpIHtcbiAgICAgIGNvbnN0IGlzQ3VycmVudExvY2F0aW9uID0gbG9jYXRpb25EYXRhLnNvbWUobG9jID0+IFxuICAgICAgICBsb2MueWVhciA9PT0gc2VsZWN0ZWRZZWFyICYmIFxuICAgICAgICBsb2MubGF0ID09PSBkLmxhdCAmJiBcbiAgICAgICAgbG9jLmxvbiA9PT0gZC5sb25cbiAgICAgICk7XG5cbiAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAuYXR0cihcInJcIiwgaXNDdXJyZW50TG9jYXRpb24gPyA4IDogNClcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgaXNDdXJyZW50TG9jYXRpb24gPyAyIDogMSk7XG5cbiAgICAgIHRvb2x0aXAuc3R5bGUub3BhY2l0eSA9IFwiMFwiO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB0b29sdGlwLnN0eWxlLmxlZnQgPSAoZXZlbnQucGFnZVggKyAxNSkgKyBcInB4XCI7XG4gICAgICB0b29sdGlwLnN0eWxlLnRvcCA9IChldmVudC5wYWdlWSAtIDI4KSArIFwicHhcIjtcbiAgICB9KTtcblxuICAvLyBBZGQgbGFiZWwgZm9yIGN1cnJlbnQgbG9jYXRpb25cbiAgbGV0IGN1cnJlbnRMb2NhdGlvbkxhYmVsID0gbnVsbDtcbiAgbGV0IGN1cnJlbnRMb2NhdGlvbkJnID0gbnVsbDtcblxuICBpZiAoY3VycmVudExvY2F0aW9uKSB7XG4gICAgY29uc3QgW3gsIHldID0gcHJvamVjdGlvbihbY3VycmVudExvY2F0aW9uLmxvbiwgY3VycmVudExvY2F0aW9uLmxhdF0pO1xuXG4gICAgY3VycmVudExvY2F0aW9uQmcgPSBtYXJrZXJzR3JvdXAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIHggKyAxMClcbiAgICAgIC5hdHRyKFwieVwiLCB5IC0gMTUpXG4gICAgICAuYXR0cihcIndpZHRoXCIsIGAke2N1cnJlbnRMb2NhdGlvbi5sb2NhdGlvbi5sZW5ndGggKiA4ICsgMzB9cHhgKVxuICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgXCIyMnB4XCIpXG4gICAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmxhYmVsQmcpXG4gICAgICAuYXR0cihcInJ4XCIsIDMpXG4gICAgICAuYXR0cihcInJ5XCIsIDMpO1xuXG4gICAgY3VycmVudExvY2F0aW9uTGFiZWwgPSBtYXJrZXJzR3JvdXAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIHggKyAxMilcbiAgICAgIC5hdHRyKFwieVwiLCB5KVxuICAgICAgLnRleHQoYCR7Y3VycmVudExvY2F0aW9uLmxvY2F0aW9ufSAoJHtjdXJyZW50TG9jYXRpb24ueWVhcn0pYClcbiAgICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJzYW5zLXNlcmlmXCIpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjE0cHhcIilcbiAgICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpXG4gICAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmxhYmVsVGV4dCk7XG4gIH1cblxuICAvLyBBZGQgem9vbSBjb250cm9sc1xuICBjb25zdCB6b29tQ29udHJvbHMgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt3aWR0aCAtIDcwfSwgMjApYCk7XG5cbiAgLy8gWm9vbSBpbiBidXR0b25cbiAgY29uc3Qgem9vbUluQnV0dG9uID0gem9vbUNvbnRyb2xzLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInhcIiwgMClcbiAgICAuYXR0cihcInlcIiwgMClcbiAgICAuYXR0cihcIndpZHRoXCIsIDMwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDMwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuY29udHJvbHNCdXR0b25CZylcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuY291bnRyeVN0cm9rZSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJyeVwiLCA1KVxuICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgIC5vbihcImNsaWNrXCIsICgpID0+IHpvb20uc2NhbGVCeShzdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKDMwMCksIDEuNSkpO1xuXG4gIGNvbnN0IHpvb21JblRleHQgPSB6b29tQ29udHJvbHMuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCAxNSlcbiAgICAuYXR0cihcInlcIiwgMjApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuY29udHJvbHNUZXh0KVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiMThweFwiKVxuICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgXCJib2xkXCIpXG4gICAgLmF0dHIoXCJwb2ludGVyLWV2ZW50c1wiLCBcIm5vbmVcIilcbiAgICAudGV4dChcIitcIik7XG5cbiAgLy8gWm9vbSBvdXQgYnV0dG9uXG4gIGNvbnN0IHpvb21PdXRCdXR0b24gPSB6b29tQ29udHJvbHMuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCA0MClcbiAgICAuYXR0cihcIndpZHRoXCIsIDMwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDMwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuY29udHJvbHNCdXR0b25CZylcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuY291bnRyeVN0cm9rZSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJyeVwiLCA1KVxuICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgIC5vbihcImNsaWNrXCIsICgpID0+IHpvb20uc2NhbGVCeShzdmcudHJhbnNpdGlvbigpLmR1cmF0aW9uKDMwMCksIDAuNzUpKTtcblxuICBjb25zdCB6b29tT3V0VGV4dCA9IHpvb21Db250cm9scy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDE1KVxuICAgIC5hdHRyKFwieVwiLCA2MClcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5jb250cm9sc1RleHQpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxOHB4XCIpXG4gICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAuYXR0cihcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKVxuICAgIC50ZXh0KFwi4oiSXCIpO1xuXG4gIC8vIFJlc2V0IGJ1dHRvblxuICBjb25zdCByZXNldEJ1dHRvbiA9IHpvb21Db250cm9scy5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ5XCIsIDgwKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMzApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMzApXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5jb250cm9sc0J1dHRvbkJnKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNvbG9ycy5jb3VudHJ5U3Ryb2tlKVxuICAgIC5hdHRyKFwicnhcIiwgNSlcbiAgICAuYXR0cihcInJ5XCIsIDUpXG4gICAgLmF0dHIoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpXG4gICAgLm9uKFwiY2xpY2tcIiwgcmVzZXRab29tKTtcblxuICBjb25zdCByZXNldFRleHQgPSB6b29tQ29udHJvbHMuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCAxNSlcbiAgICAuYXR0cihcInlcIiwgMTAwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmNvbnRyb2xzVGV4dClcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjE0cHhcIilcbiAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgIC5hdHRyKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpXG4gICAgLnRleHQoXCJSXCIpO1xuXG4gIC8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBhbGwgY29sb3JzIGJhc2VkIG9uIGN1cnJlbnQgdGhlbWVcbiAgZnVuY3Rpb24gdXBkYXRlTWFwQ29sb3JzKCkge1xuICAgIGNvbnN0IGN1cnJlbnRDb2xvcnMgPSBnZXRUaW1lbGluZVRoZW1lQ29sb3JzKCk7XG5cbiAgICAvLyBVcGRhdGUgY291bnRyaWVzXG4gICAgY291bnRyaWVzXG4gICAgICAuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5sYW5kQ29sb3IpXG4gICAgICAuYXR0cihcInN0cm9rZVwiLCBjdXJyZW50Q29sb3JzLmNvdW50cnlTdHJva2UpO1xuXG4gICAgLy8gVXBkYXRlIHBhdGhzXG4gICAgZnV0dXJlUGF0aC5hdHRyKFwic3Ryb2tlXCIsIGN1cnJlbnRDb2xvcnMuZnV0dXJlUGF0aCk7XG4gICAgaWYgKHRyYXZlbGVkUGF0aCkge1xuICAgICAgdHJhdmVsZWRQYXRoLmF0dHIoXCJzdHJva2VcIiwgY3VycmVudENvbG9ycy50cmF2ZWxlZFBhdGgpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBtYXJrZXJzXG4gICAgbWFya2Vyc1xuICAgICAgLmF0dHIoXCJmaWxsXCIsIGQgPT4ge1xuICAgICAgICBjb25zdCBpc0N1cnJlbnRMb2NhdGlvbiA9IGxvY2F0aW9uRGF0YS5zb21lKGxvYyA9PiBcbiAgICAgICAgICBsb2MueWVhciA9PT0gc2VsZWN0ZWRZZWFyICYmIFxuICAgICAgICAgIGxvYy5sYXQgPT09IGQubGF0ICYmIFxuICAgICAgICAgIGxvYy5sb24gPT09IGQubG9uXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBpc0N1cnJlbnRMb2NhdGlvbiA/IGN1cnJlbnRDb2xvcnMuY3VycmVudE1hcmtlciA6IGN1cnJlbnRDb2xvcnMub3RoZXJNYXJrZXJzO1xuICAgICAgfSlcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIGN1cnJlbnRDb2xvcnMubWFya2VyU3Ryb2tlKTtcblxuICAgIC8vIFVwZGF0ZSBsYWJlbHNcbiAgICBpZiAoY3VycmVudExvY2F0aW9uQmcpIHtcbiAgICAgIGN1cnJlbnRMb2NhdGlvbkJnLmF0dHIoXCJmaWxsXCIsIGN1cnJlbnRDb2xvcnMubGFiZWxCZyk7XG4gICAgfVxuICAgIGlmIChjdXJyZW50TG9jYXRpb25MYWJlbCkge1xuICAgICAgY3VycmVudExvY2F0aW9uTGFiZWwuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5sYWJlbFRleHQpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBjb250cm9sc1xuICAgIHpvb21JbkJ1dHRvbi5hdHRyKFwiZmlsbFwiLCBjdXJyZW50Q29sb3JzLmNvbnRyb2xzQnV0dG9uQmcpLmF0dHIoXCJzdHJva2VcIiwgY3VycmVudENvbG9ycy5jb3VudHJ5U3Ryb2tlKTtcbiAgICB6b29tT3V0QnV0dG9uLmF0dHIoXCJmaWxsXCIsIGN1cnJlbnRDb2xvcnMuY29udHJvbHNCdXR0b25CZykuYXR0cihcInN0cm9rZVwiLCBjdXJyZW50Q29sb3JzLmNvdW50cnlTdHJva2UpO1xuICAgIHJlc2V0QnV0dG9uLmF0dHIoXCJmaWxsXCIsIGN1cnJlbnRDb2xvcnMuY29udHJvbHNCdXR0b25CZykuYXR0cihcInN0cm9rZVwiLCBjdXJyZW50Q29sb3JzLmNvdW50cnlTdHJva2UpO1xuICAgIHpvb21JblRleHQuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5jb250cm9sc1RleHQpO1xuICAgIHpvb21PdXRUZXh0LmF0dHIoXCJmaWxsXCIsIGN1cnJlbnRDb2xvcnMuY29udHJvbHNUZXh0KTtcbiAgICByZXNldFRleHQuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5jb250cm9sc1RleHQpO1xuICB9XG5cbiAgLy8gRGVmaW5lIHpvb20gYmVoYXZpb3JcbiAgY29uc3Qgem9vbSA9IGQzLnpvb20oKVxuICAgIC5zY2FsZUV4dGVudChbMC41LCA4XSlcbiAgICAub24oXCJ6b29tXCIsIHpvb21lZCk7XG5cbiAgZnVuY3Rpb24gem9vbWVkKGV2ZW50KSB7XG4gICAgZy5hdHRyKFwidHJhbnNmb3JtXCIsIGV2ZW50LnRyYW5zZm9ybSk7XG4gICAgY29uc3Qgc3Ryb2tlU2NhbGUgPSAxIC8gTWF0aC5zcXJ0KGV2ZW50LnRyYW5zZm9ybS5rKTtcbiAgICBnLnNlbGVjdEFsbChcInBhdGhcIikuYXR0cihcInN0cm9rZS13aWR0aFwiLCAwLjUgKiBzdHJva2VTY2FsZSk7XG5cbiAgICBtYXJrZXJzR3JvdXAuc2VsZWN0QWxsKFwiY2lyY2xlXCIpLmVhY2goZnVuY3Rpb24oZCkge1xuICAgICAgY29uc3QgaXNDdXJyZW50TG9jYXRpb24gPSBsb2NhdGlvbkRhdGEuc29tZShsb2MgPT4gXG4gICAgICAgIGxvYy55ZWFyID09PSBzZWxlY3RlZFllYXIgJiYgXG4gICAgICAgIGxvYy5sYXQgPT09IGQubGF0ICYmIFxuICAgICAgICBsb2MubG9uID09PSBkLmxvblxuICAgICAgKTtcblxuICAgICAgZDMuc2VsZWN0KHRoaXMpXG4gICAgICAgIC5hdHRyKFwiclwiLCAoaXNDdXJyZW50TG9jYXRpb24gPyA4IDogNCkgKiBzdHJva2VTY2FsZSlcbiAgICAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgKGlzQ3VycmVudExvY2F0aW9uID8gMiA6IDEpICogc3Ryb2tlU2NhbGUpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRab29tKCkge1xuICAgIHN2Zy50cmFuc2l0aW9uKCkuZHVyYXRpb24oNzUwKS5jYWxsKFxuICAgICAgem9vbS50cmFuc2Zvcm0sXG4gICAgICBkMy56b29tSWRlbnRpdHlcbiAgICApO1xuICB9XG5cbiAgLy8gRW5hYmxlIHpvb20gYW5kIHBhbiBvbiB0aGUgU1ZHXG4gIHN2Zy5jYWxsKHpvb20pO1xuXG4gIC8vIExpc3RlbiBmb3IgdGhlbWUgY2hhbmdlcyBhbmQgdXBkYXRlIGNvbG9ycyBhY2NvcmRpbmdseVxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICB1cGRhdGVNYXBDb2xvcnMoKTtcbiAgfSk7XG5cbiAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XG4gICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsnY2xhc3MnXVxuICB9KTtcblxuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cblxuLy8gRGlzcGxheSB0aGUgbWFwXG5tYXBWaXN1YWxpemF0aW9uO1xuXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEltcG9ydCByZXF1aXJlZCBsaWJyYXJpZXMgd2l0aCB1bmlxdWUgdmFyaWFibGUgbmFtZXNcbmQzSGlnaGxpZ2h0ID0gcmVxdWlyZShcImQzQDdcIilcbnRvcG9IaWdobGlnaHQgPSByZXF1aXJlKFwidG9wb2pzb24tY2xpZW50QDNcIilcblxuLy8gWW91ciBsaXN0IG9mIHZpc2l0ZWQgY291bnRyaWVzXG5jb3VudHJpZXNWaXNpdGVkID0gW1xuICBcIkdlcm1hbnlcIiwgXCJGcmFuY2VcIiwgXCJVU0FcIiwgXCJTcGFpblwiLCBcIkl0YWx5XCIsIFwiQXVzdHJpYVwiLCBcbiAgXCJTd2l0emVybGFuZFwiLCBcIk5ldGhlcmxhbmRzXCIsIFwiQmVsZ2l1bVwiLCBcIlNhbiBNYXJpbm9cIiwgXG4gIFwiVmF0aWNhblwiLCBcIk1hbHRhXCIsIFwiTW9uYWNvXCIsIFwiVW5pdGVkIEtpbmdkb21cIlxuXVxuXG4vLyBMb2FkIHdvcmxkIG1hcCBkYXRhIHdpdGggYSB1bmlxdWUgdmFyaWFibGUgbmFtZVxud29ybGRHZW9EYXRhID0ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS93b3JsZC1hdGxhc0AyL2NvdW50cmllcy0xMTBtLmpzb25cIik7XG4gIHJldHVybiB0b3BvSGlnaGxpZ2h0LmZlYXR1cmUoYXdhaXQgcmVzcG9uc2UuanNvbigpLCBcImNvdW50cmllc1wiKTtcbn1cblxuLy8gRnVuY3Rpb24gdG8gZ2V0IGN1cnJlbnQgdGhlbWUgY29sb3JzXG5nZXRUaGVtZUNvbG9ycyA9ICgpID0+IHtcbiAgY29uc3QgaXNEYXJrID0gZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ3F1YXJ0by1kYXJrJyk7XG5cbiAgaWYgKGlzRGFyaykge1xuICAgIHJldHVybiB7XG4gICAgICB2aXNpdGVkQ29sb3I6IFwiIzAwYTY1M1wiLFxuICAgICAgbm90VmlzaXRlZENvbG9yOiBcIiMzNzQxNTFcIiwgLy8gZ3JheS03MDAgZXF1aXZhbGVudFxuICAgICAgc3Ryb2tlQ29sb3I6IFwiIzZiNzI4MFwiLCAvLyBncmF5LTUwMCBlcXVpdmFsZW50XG4gICAgICBzdHJva2VIb3ZlckNvbG9yOiBcIiNmZmZmZmZcIixcbiAgICAgIHRvb2x0aXBCZzogXCJyZ2JhKDE3LCAyNCwgMzksIDAuOTUpXCIsIC8vIGdyYXktOTAwIHdpdGggb3BhY2l0eVxuICAgICAgdG9vbHRpcFRleHQ6IFwiI2ZmZmZmZlwiLFxuICAgICAgbGVnZW5kQmc6IFwicmdiYSgxNywgMjQsIDM5LCAwLjgpXCIsXG4gICAgICBsZWdlbmRUZXh0OiBcIiNmZmZmZmZcIixcbiAgICAgIGNvbnRyb2xzQmc6IFwicmdiYSgxNywgMjQsIDM5LCAwLjgpXCIsXG4gICAgICBjb250cm9sc0J1dHRvbkJnOiBcInJnYmEoNzUsIDg1LCA5OSwgMC44KVwiLCAvLyBncmF5LTYwMCB3aXRoIG9wYWNpdHlcbiAgICAgIGNvbnRyb2xzQnV0dG9uU3Ryb2tlOiBcIiM5Y2EzYWZcIiAvLyBncmF5LTQwMFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZpc2l0ZWRDb2xvcjogXCIjMDBhNjUzXCIsXG4gICAgICBub3RWaXNpdGVkQ29sb3I6IFwiI2U1ZTdlYlwiLCAvLyBncmF5LTIwMCBlcXVpdmFsZW50XG4gICAgICBzdHJva2VDb2xvcjogXCIjOWNhM2FmXCIsIC8vIGdyYXktNDAwIGVxdWl2YWxlbnRcbiAgICAgIHN0cm9rZUhvdmVyQ29sb3I6IFwiIzM3NDE1MVwiLFxuICAgICAgdG9vbHRpcEJnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45NSlcIixcbiAgICAgIHRvb2x0aXBUZXh0OiBcIiMzNzQxNTFcIixcbiAgICAgIGxlZ2VuZEJnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiLFxuICAgICAgbGVnZW5kVGV4dDogXCIjMzc0MTUxXCIsXG4gICAgICBjb250cm9sc0JnOiBcInJnYmEoMjU1LCAyNTUsIDI1NSwgMC45KVwiLFxuICAgICAgY29udHJvbHNCdXR0b25CZzogXCJyZ2JhKDI0MywgMjQ0LCAyNDYsIDAuOClcIiwgLy8gZ3JheS0xMDAgd2l0aCBvcGFjaXR5XG4gICAgICBjb250cm9sc0J1dHRvblN0cm9rZTogXCIjZDFkNWRiXCIgLy8gZ3JheS0zMDBcbiAgICB9O1xuICB9XG59XG5cbi8vIE1hcCB2aXN1YWxpemF0aW9uIHdpdGggdGhlbWUtYWRhcHRpdmUgY29sb3JzXG5oaWdobGlnaHRlZENvdW50cmllc01hcCA9IHtcbiAgY29uc3QgY29sb3JzID0gZ2V0VGhlbWVDb2xvcnMoKTtcblxuICAvLyBTZXQgdXAgZGltZW5zaW9ucyBhbmQgcHJvamVjdGlvblxuICBjb25zdCBtYXBXaWR0aCA9IDkwMDtcbiAgY29uc3QgbWFwSGVpZ2h0ID0gNTAwO1xuXG4gIC8vIENyZWF0ZSBhIHByb2plY3Rpb24gZm9jdXNlZCBvbiB0aGUgd29ybGRcbiAgY29uc3QgbWFwUHJvamVjdGlvbiA9IGQzSGlnaGxpZ2h0Lmdlb01lcmNhdG9yKClcbiAgICAuY2VudGVyKFsxMCwgNDVdKVxuICAgIC5zY2FsZSgxNTApXG4gICAgLnRyYW5zbGF0ZShbbWFwV2lkdGggLyAyLCBtYXBIZWlnaHQgLyAyXSk7XG5cbiAgLy8gQ3JlYXRlIHBhdGggZ2VuZXJhdG9yXG4gIGNvbnN0IG1hcFBhdGggPSBkM0hpZ2hsaWdodC5nZW9QYXRoKCkucHJvamVjdGlvbihtYXBQcm9qZWN0aW9uKTtcblxuICAvLyBDcmVhdGUgU1ZHIHdpdGggdHJhbnNwYXJlbnQgYmFja2dyb3VuZFxuICBjb25zdCBtYXBTdmcgPSBkM0hpZ2hsaWdodC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIG1hcFdpZHRoKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcEhlaWdodClcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIG1hcFdpZHRoLCBtYXBIZWlnaHRdKVxuICAgIC5hdHRyKFwic3R5bGVcIiwgXCJtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgYmFja2dyb3VuZDogbm9uZTtcIik7XG5cbiAgLy8gQ3JlYXRlIGEgZ3JvdXAgZm9yIGFsbCBtYXAgZWxlbWVudHNcbiAgY29uc3QgbWFwR3JvdXAgPSBtYXBTdmcuYXBwZW5kKFwiZ1wiKTtcblxuICAvLyBDcmVhdGUgYSB0b29sdGlwXG4gIGNvbnN0IG1hcFRvb2x0aXAgPSBkM0hpZ2hsaWdodC5zZWxlY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKSlcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiaGlnaGxpZ2h0LW1hcC10b29sdGlwXCIpXG4gICAgLnN0eWxlKFwicG9zaXRpb25cIiwgXCJhYnNvbHV0ZVwiKVxuICAgIC5zdHlsZShcImJhY2tncm91bmRcIiwgY29sb3JzLnRvb2x0aXBCZylcbiAgICAuc3R5bGUoXCJjb2xvclwiLCBjb2xvcnMudG9vbHRpcFRleHQpXG4gICAgLnN0eWxlKFwiYm9yZGVyLXJhZGl1c1wiLCBcIjVweFwiKVxuICAgIC5zdHlsZShcInBhZGRpbmdcIiwgXCI4cHhcIilcbiAgICAuc3R5bGUoXCJwb2ludGVyLWV2ZW50c1wiLCBcIm5vbmVcIilcbiAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXG4gICAgLnN0eWxlKFwiei1pbmRleFwiLCAxMDAwKVxuICAgIC5zdHlsZShcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBcIjE0cHhcIik7XG5cbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtYXBUb29sdGlwLm5vZGUoKSk7XG5cbiAgLy8gQ291bnRyeSBuYW1lIG1hcHBpbmcgZm9yIHNwZWNpYWwgY2FzZXNcbiAgY29uc3QgY291bnRyeU5hbWVNYXAgPSB7XG4gICAgXCJVbml0ZWQgU3RhdGVzIG9mIEFtZXJpY2FcIjogXCJVU0FcIixcbiAgICBcIlVuaXRlZCBTdGF0ZXNcIjogXCJVU0FcIixcbiAgICBcIkhvbHkgU2VlXCI6IFwiVmF0aWNhblwiLFxuICAgIFwiVmF0aWNhbiBDaXR5XCI6IFwiVmF0aWNhblwiLFxuICAgIFwiVmF0aWNhblwiOiBcIlZhdGljYW5cIixcbiAgICBcIlNhbiBNYXJpbm9cIjogXCJTYW4gTWFyaW5vXCJcbiAgfTtcblxuICAvLyBGdW5jdGlvbiB0byB1cGRhdGUgbWFwIGNvbG9ycyBiYXNlZCBvbiBjdXJyZW50IHRoZW1lXG4gIGZ1bmN0aW9uIHVwZGF0ZU1hcENvbG9ycygpIHtcbiAgICBjb25zdCBjdXJyZW50Q29sb3JzID0gZ2V0VGhlbWVDb2xvcnMoKTtcblxuICAgIC8vIFVwZGF0ZSBjb3VudHJ5IGNvbG9yc1xuICAgIG1hcEdyb3VwLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBkID0+IHtcbiAgICAgICAgY29uc3QgY291bnRyeU5hbWUgPSBkLnByb3BlcnRpZXMubmFtZTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZE5hbWUgPSBjb3VudHJ5TmFtZU1hcFtjb3VudHJ5TmFtZV0gfHwgY291bnRyeU5hbWU7XG4gICAgICAgIHJldHVybiBjb3VudHJpZXNWaXNpdGVkLmluY2x1ZGVzKG5vcm1hbGl6ZWROYW1lKSA/IGN1cnJlbnRDb2xvcnMudmlzaXRlZENvbG9yIDogY3VycmVudENvbG9ycy5ub3RWaXNpdGVkQ29sb3I7XG4gICAgICB9KVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgY3VycmVudENvbG9ycy5zdHJva2VDb2xvcik7XG5cbiAgICAvLyBVcGRhdGUgdG9vbHRpcCBjb2xvcnNcbiAgICBtYXBUb29sdGlwXG4gICAgICAuc3R5bGUoXCJiYWNrZ3JvdW5kXCIsIGN1cnJlbnRDb2xvcnMudG9vbHRpcEJnKVxuICAgICAgLnN0eWxlKFwiY29sb3JcIiwgY3VycmVudENvbG9ycy50b29sdGlwVGV4dCk7XG5cbiAgICAvLyBVcGRhdGUgbGVnZW5kIGNvbG9yc1xuICAgIG1hcExlZ2VuZC5zZWxlY3QoXCIubGVnZW5kLWJnXCIpXG4gICAgICAuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5sZWdlbmRCZyk7XG5cbiAgICBtYXBMZWdlbmQuc2VsZWN0QWxsKFwiLmxlZ2VuZC10ZXh0XCIpXG4gICAgICAuc3R5bGUoXCJmaWxsXCIsIGN1cnJlbnRDb2xvcnMubGVnZW5kVGV4dCk7XG5cbiAgICAvLyBVcGRhdGUgY29udHJvbCBjb2xvcnNcbiAgICBtYXBab29tQ29udHJvbHMuc2VsZWN0KFwiLmNvbnRyb2xzLWJnXCIpXG4gICAgICAuYXR0cihcImZpbGxcIiwgY3VycmVudENvbG9ycy5jb250cm9sc0JnKTtcblxuICAgIG1hcFpvb21Db250cm9scy5zZWxlY3RBbGwoXCIuY29udHJvbC1idXR0b25cIilcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBjdXJyZW50Q29sb3JzLmNvbnRyb2xzQnV0dG9uQmcpXG4gICAgICAuYXR0cihcInN0cm9rZVwiLCBjdXJyZW50Q29sb3JzLmNvbnRyb2xzQnV0dG9uU3Ryb2tlKTtcbiAgfVxuXG4gIC8vIERyYXcgY291bnRyaWVzXG4gIGNvbnN0IGNvdW50cmllcyA9IG1hcEdyb3VwLnNlbGVjdEFsbChcInBhdGhcIilcbiAgICAuZGF0YSh3b3JsZEdlb0RhdGEuZmVhdHVyZXMpXG4gICAgLmpvaW4oXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGQgPT4ge1xuICAgICAgY29uc3QgY291bnRyeU5hbWUgPSBkLnByb3BlcnRpZXMubmFtZTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWROYW1lID0gY291bnRyeU5hbWVNYXBbY291bnRyeU5hbWVdIHx8IGNvdW50cnlOYW1lO1xuICAgICAgcmV0dXJuIGNvdW50cmllc1Zpc2l0ZWQuaW5jbHVkZXMobm9ybWFsaXplZE5hbWUpID8gY29sb3JzLnZpc2l0ZWRDb2xvciA6IGNvbG9ycy5ub3RWaXNpdGVkQ29sb3I7XG4gICAgfSlcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuc3Ryb2tlQ29sb3IpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMC41KVxuICAgIC5hdHRyKFwiZFwiLCBtYXBQYXRoKVxuICAgIC5vbihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbihldmVudCwgZCkge1xuICAgICAgY29uc3QgY3VycmVudENvbG9ycyA9IGdldFRoZW1lQ29sb3JzKCk7XG4gICAgICBkM0hpZ2hsaWdodC5zZWxlY3QodGhpcykuYXR0cihcInN0cm9rZS13aWR0aFwiLCAxLjUpLmF0dHIoXCJzdHJva2VcIiwgY3VycmVudENvbG9ycy5zdHJva2VIb3ZlckNvbG9yKTtcblxuICAgICAgY29uc3QgY291bnRyeU5hbWUgPSBkLnByb3BlcnRpZXMubmFtZTtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWROYW1lID0gY291bnRyeU5hbWVNYXBbY291bnRyeU5hbWVdIHx8IGNvdW50cnlOYW1lO1xuICAgICAgY29uc3QgaXNWaXNpdGVkID0gY291bnRyaWVzVmlzaXRlZC5pbmNsdWRlcyhub3JtYWxpemVkTmFtZSk7XG5cbiAgICAgIG1hcFRvb2x0aXBcbiAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxuICAgICAgICAuaHRtbChgPHN0cm9uZz4ke2NvdW50cnlOYW1lfTwvc3Ryb25nPjxici8+JHtpc1Zpc2l0ZWQgPyBcIuKckyBWaXNpdGVkXCIgOiBcIk5vdCB2aXNpdGVkXCJ9YClcbiAgICAgICAgLnN0eWxlKFwibGVmdFwiLCAoZXZlbnQucGFnZVggKyAxMCkgKyBcInB4XCIpXG4gICAgICAgIC5zdHlsZShcInRvcFwiLCAoZXZlbnQucGFnZVkgLSAyOCkgKyBcInB4XCIpO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2VvdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBjdXJyZW50Q29sb3JzID0gZ2V0VGhlbWVDb2xvcnMoKTtcbiAgICAgIGQzSGlnaGxpZ2h0LnNlbGVjdCh0aGlzKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDAuNSkuYXR0cihcInN0cm9rZVwiLCBjdXJyZW50Q29sb3JzLnN0cm9rZUNvbG9yKTtcbiAgICAgIG1hcFRvb2x0aXAuc3R5bGUoXCJvcGFjaXR5XCIsIDApO1xuICAgIH0pXG4gICAgLm9uKFwibW91c2Vtb3ZlXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICBtYXBUb29sdGlwXG4gICAgICAgIC5zdHlsZShcImxlZnRcIiwgKGV2ZW50LnBhZ2VYICsgMTApICsgXCJweFwiKVxuICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGV2ZW50LnBhZ2VZIC0gMjgpICsgXCJweFwiKTtcbiAgICB9KTtcblxuICAvLyBBZGQgYSBsZWdlbmRcbiAgY29uc3QgbWFwTGVnZW5kID0gbWFwU3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDIwLCAke21hcEhlaWdodCAtIDYwfSlgKTtcblxuICAvLyBCYWNrZ3JvdW5kIGZvciBsZWdlbmRcbiAgbWFwTGVnZW5kLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwibGVnZW5kLWJnXCIpXG4gICAgLmF0dHIoXCJ4XCIsIC01KVxuICAgIC5hdHRyKFwieVwiLCAtMTUpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCAxMjApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgNzApXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5sZWdlbmRCZylcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJyeVwiLCA1KTtcblxuICAvLyBWaXNpdGVkIGNvdW50cmllcyBsZWdlbmRcbiAgbWFwTGVnZW5kLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIDIwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDIwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMudmlzaXRlZENvbG9yKTtcblxuICBtYXBMZWdlbmQuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsZWdlbmQtdGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCAzMClcbiAgICAuYXR0cihcInlcIiwgMTUpXG4gICAgLnRleHQoXCJWaXNpdGVkXCIpXG4gICAgLnN0eWxlKFwiZm9udC1mYW1pbHlcIiwgXCJzYW5zLXNlcmlmXCIpXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIFwiMTRweFwiKVxuICAgIC5zdHlsZShcImZpbGxcIiwgY29sb3JzLmxlZ2VuZFRleHQpO1xuXG4gIC8vIE5vdCB2aXNpdGVkIGNvdW50cmllcyBsZWdlbmRcbiAgbWFwTGVnZW5kLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIDIwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDIwKVxuICAgIC5hdHRyKFwieVwiLCAzMClcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLm5vdFZpc2l0ZWRDb2xvcik7XG5cbiAgbWFwTGVnZW5kLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwibGVnZW5kLXRleHRcIilcbiAgICAuYXR0cihcInhcIiwgMzApXG4gICAgLmF0dHIoXCJ5XCIsIDQ1KVxuICAgIC50ZXh0KFwiTm90IFZpc2l0ZWRcIilcbiAgICAuc3R5bGUoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgXCIxNHB4XCIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBjb2xvcnMubGVnZW5kVGV4dCk7XG5cbiAgLy8gQWRkIHpvb20gY29udHJvbHNcbiAgY29uc3QgbWFwWm9vbUNvbnRyb2xzID0gbWFwU3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFwV2lkdGggLSA3MH0sIDIwKWApO1xuXG4gIC8vIEJhY2tncm91bmQgZm9yIHpvb20gY29udHJvbHNcbiAgbWFwWm9vbUNvbnRyb2xzLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY29udHJvbHMtYmdcIilcbiAgICAuYXR0cihcInhcIiwgLTUpXG4gICAgLmF0dHIoXCJ5XCIsIC01KVxuICAgIC5hdHRyKFwid2lkdGhcIiwgNDApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMTIwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuY29udHJvbHNCZylcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJyeVwiLCA1KTtcblxuICAvLyBab29tIGluIGJ1dHRvblxuICBtYXBab29tQ29udHJvbHMuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjb250cm9sLWJ1dHRvblwiKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCAwKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgMzApXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgMzApXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5jb250cm9sc0J1dHRvbkJnKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIGNvbG9ycy5jb250cm9sc0J1dHRvblN0cm9rZSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJyeVwiLCA1KVxuICAgIC5hdHRyKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgIC5vbihcImNsaWNrXCIsICgpID0+IG1hcFpvb21CZWhhdmlvci5zY2FsZUJ5KG1hcFN2Zy50cmFuc2l0aW9uKCkuZHVyYXRpb24oMzAwKSwgMS41KSk7XG5cbiAgbWFwWm9vbUNvbnRyb2xzLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgMTUpXG4gICAgLmF0dHIoXCJ5XCIsIDIwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmxlZ2VuZFRleHQpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxOHB4XCIpXG4gICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAuYXR0cihcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKVxuICAgIC50ZXh0KFwiK1wiKTtcblxuICAvLyBab29tIG91dCBidXR0b25cbiAgbWFwWm9vbUNvbnRyb2xzLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiY29udHJvbC1idXR0b25cIilcbiAgICAuYXR0cihcInhcIiwgMClcbiAgICAuYXR0cihcInlcIiwgNDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCAzMClcbiAgICAuYXR0cihcImhlaWdodFwiLCAzMClcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmNvbnRyb2xzQnV0dG9uQmcpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JzLmNvbnRyb2xzQnV0dG9uU3Ryb2tlKVxuICAgIC5hdHRyKFwicnhcIiwgNSlcbiAgICAuYXR0cihcInJ5XCIsIDUpXG4gICAgLmF0dHIoXCJjdXJzb3JcIiwgXCJwb2ludGVyXCIpXG4gICAgLm9uKFwiY2xpY2tcIiwgKCkgPT4gbWFwWm9vbUJlaGF2aW9yLnNjYWxlQnkobWFwU3ZnLnRyYW5zaXRpb24oKS5kdXJhdGlvbigzMDApLCAwLjc1KSk7XG5cbiAgbWFwWm9vbUNvbnRyb2xzLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgMTUpXG4gICAgLmF0dHIoXCJ5XCIsIDYwKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLmxlZ2VuZFRleHQpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIxOHB4XCIpXG4gICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCBcImJvbGRcIilcbiAgICAuYXR0cihcInBvaW50ZXItZXZlbnRzXCIsIFwibm9uZVwiKVxuICAgIC50ZXh0KFwi4oiSXCIpO1xuXG4gIC8vIFJlc2V0IGJ1dHRvblxuICBtYXBab29tQ29udHJvbHMuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjb250cm9sLWJ1dHRvblwiKVxuICAgIC5hdHRyKFwieFwiLCAwKVxuICAgIC5hdHRyKFwieVwiLCA4MClcbiAgICAuYXR0cihcIndpZHRoXCIsIDMwKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDMwKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuY29udHJvbHNCdXR0b25CZylcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuY29udHJvbHNCdXR0b25TdHJva2UpXG4gICAgLmF0dHIoXCJyeFwiLCA1KVxuICAgIC5hdHRyKFwicnlcIiwgNSlcbiAgICAuYXR0cihcImN1cnNvclwiLCBcInBvaW50ZXJcIilcbiAgICAub24oXCJjbGlja1wiLCByZXNldE1hcFpvb20pO1xuXG4gIG1hcFpvb21Db250cm9scy5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDE1KVxuICAgIC5hdHRyKFwieVwiLCAxMDApXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMubGVnZW5kVGV4dClcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBcIjE0cHhcIilcbiAgICAuYXR0cihcImZvbnQtd2VpZ2h0XCIsIFwiYm9sZFwiKVxuICAgIC5hdHRyKFwicG9pbnRlci1ldmVudHNcIiwgXCJub25lXCIpXG4gICAgLnRleHQoXCJSXCIpO1xuXG4gIC8vIERlZmluZSB6b29tIGJlaGF2aW9yXG4gIGNvbnN0IG1hcFpvb21CZWhhdmlvciA9IGQzSGlnaGxpZ2h0Lnpvb20oKVxuICAgIC5zY2FsZUV4dGVudChbMSwgOF0pXG4gICAgLm9uKFwiem9vbVwiLCBtYXBab29tZWQpO1xuXG4gIGZ1bmN0aW9uIG1hcFpvb21lZChldmVudCkge1xuICAgIG1hcEdyb3VwLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZXZlbnQudHJhbnNmb3JtKTtcbiAgICBjb25zdCBtYXBTdHJva2VTY2FsZSA9IDEgLyBNYXRoLnNxcnQoZXZlbnQudHJhbnNmb3JtLmspO1xuICAgIG1hcEdyb3VwLnNlbGVjdEFsbChcInBhdGhcIikuYXR0cihcInN0cm9rZS13aWR0aFwiLCAwLjUgKiBtYXBTdHJva2VTY2FsZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldE1hcFpvb20oKSB7XG4gICAgbWFwU3ZnLnRyYW5zaXRpb24oKS5kdXJhdGlvbig3NTApLmNhbGwoXG4gICAgICBtYXBab29tQmVoYXZpb3IudHJhbnNmb3JtLFxuICAgICAgZDNIaWdobGlnaHQuem9vbUlkZW50aXR5XG4gICAgKTtcbiAgfVxuXG4gIC8vIEVuYWJsZSB6b29tIGFuZCBwYW4gb24gdGhlIFNWR1xuICBtYXBTdmcuY2FsbChtYXBab29tQmVoYXZpb3IpO1xuXG4gIC8vIExpc3RlbiBmb3IgdGhlbWUgY2hhbmdlcyBhbmQgdXBkYXRlIGNvbG9ycyBhY2NvcmRpbmdseVxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICB1cGRhdGVNYXBDb2xvcnMoKTtcbiAgfSk7XG5cbiAgb2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCB7XG4gICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsnY2xhc3MnXVxuICB9KTtcblxuICByZXR1cm4gbWFwU3ZnLm5vZGUoKTtcbn1cblxuLy8gRGlzcGxheSB0aGUgbWFwXG5oaWdobGlnaHRlZENvdW50cmllc01hcFxuXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdGVkWWVhcicpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../about";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https://www.lukmayer.github.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lukmayer/website">
      <i class="bi bi-code-slash" role="img" aria-label="Source code">
</i> 
    </a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://quarto.org">
<p>Made with <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewbox="0 0 24 24"><path fill="currentColor" d="M12.65 12.854V24c6.042-.325 10.923-5.105 11.33-11.125H12.65Zm-1.504 0H.02c.427 5.94 5.166 10.699 11.105 11.105V12.854Zm1.505-1.505H24C23.675 5.247 18.753.325 12.65 0Zm-1.505 0V0C5.106.427.326 5.308 0 11.35Z"></path></svg></p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="../blog/index.xml">
      <i class="bi bi-rss-fill" role="img" aria-label="Blog RSS feed">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>